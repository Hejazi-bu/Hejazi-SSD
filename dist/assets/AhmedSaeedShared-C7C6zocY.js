import{r as t,q as $,o as D,h as E,i as L,g as I,k as e,m as z,x as ue,A as xe,aQ as Y,aw as he,aR as X,aO as J,aP as q,au as fe,aS as pe,ao as be,H as ye,ar as ve,N as je,D as we,E as Ne}from"./index-AlbxRJrk.js";import{F as Fe}from"./PencilIcon-DZheH_sc.js";import{F as Se}from"./ChevronDownIcon-BtYLWBft.js";import{F as ke,a as Ce}from"./TrashIcon-DqVoRP7K.js";function Me({title:r,titleId:c,...i},n){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":c},i),r?t.createElement("title",{id:c},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))}const Qe=t.forwardRef(Me);function $e({title:r,titleId:c,...i},n){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":c},i),r?t.createElement("title",{id:c},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const De=t.forwardRef($e);function Ee({title:r,titleId:c,...i},n){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":c},i),r?t.createElement("title",{id:c},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Le=t.forwardRef(Ee),V=()=>({toFirestore:r=>r,fromFirestore:(r,c)=>({id:r.id,...r.data(c)})}),Re=V(),W=V(),Ue=()=>{const r=t.useMemo(()=>$(E(L,"app_services").withConverter(W),D("name")),[]),[c,i,n]=I(r);return{allServices:c,servicesLoading:i,servicesError:n}},ze=()=>{const r=t.useMemo(()=>$(E(L,"app_universities").withConverter(W),D("name")),[]),[c,i,n]=I(r);return{allUniversities:c,universitiesLoading:i,universitiesError:n}},Je=()=>{const r=t.useMemo(()=>$(E(L,"app_responsible_persons").withConverter(W),D("name")),[]),[c,i,n]=I(r);return{allPersons:c,personsLoading:i,personsError:n}},qe=()=>{const r=t.useMemo(()=>$(E(L,"app_countries").withConverter(Re),D("name_ar")),[]),[c,i,n]=I(r);return{allCountries:c,countriesLoading:i,countriesError:n}};function Ae({isOpen:r,onClose:c,title:i,options:n,selectedIds:x,onSave:T,nameField:f="name",collectionName:_,readOnly:R=!1,dialogHook:H,actionLoadingHook:O,enableOrdering:Z=!1,libraryCollection:h}){const[p,w]=t.useState("all"),[u,N]=t.useState(x),[F,y]=t.useState([]),[o,b]=t.useState(!1),[a,d]=t.useState([]),[g,C]=t.useState(!1),[B,M]=t.useState(""),[Ie,ee]=t.useState(""),[Te,K]=t.useState(!1),[_e,te]=t.useState(null),[He,se]=t.useState(""),[P,A]=t.useState(!1),{showDialog:S}=H,{showActionLoading:re,hideActionLoading:ae}=O;t.useRef(null),t.useRef(null),t.useEffect(()=>{r&&(M(""),ee(""),te(null),se(""),K(!1),A(!1),w("all"),b(!1),N(x))},[r,x]),t.useEffect(()=>{if(r)if(o){const s=n.map(m=>m.id),l=JSON.stringify([...F].sort())!==JSON.stringify([...s].sort());A(l)}else{const s=JSON.stringify([...u].sort())!==JSON.stringify([...x].sort());A(s)}},[u,F,o,n,x,r]);const G=async()=>{if(!h)return;b(!0),M("");const s=n.map(l=>l.id);if(y(s),a.length===0){C(!0);try{const l=$(E(L,h),D(f==="name_ar"?"name_ar":"name")),v=(await je(l)).docs.map(j=>({id:j.id,...j.data()}));d(v)}catch(l){console.error(l),S({variant:"alert",title:"خطأ",message:"فشل تحميل المكتبة"})}finally{C(!1)}}},ne=()=>{P?S({variant:"confirm",title:"تجاهل التعديلات؟",message:"لديك تعديلات غير محفوظة على القائمة. هل تريد الخروج دون حفظ؟",onConfirm:()=>{b(!1),M("")}}):(b(!1),M(""))},oe=s=>{o?y(l=>l.includes(s)?l.filter(m=>m!==s):[...l,s]):N(l=>l.includes(s)?l.filter(m=>m!==s):[...l,s])},le=()=>{T(u),c()},ce=async()=>{S({variant:"confirm",title:"تحديث القائمة الشخصية",message:`سيتم تحديث قائمة الدول المتاحة لك لاستخدامها في المهام. 
(لن يؤثر هذا على المهام القديمة، ولكنه يحدد ما يظهر لك مستقبلاً).`,confirmText:"تحديث القائمة",onConfirm:async()=>{re("جاري مزامنة القائمة...");try{await we(Ne,"manageAppCountries")({selectedIds:F}),S({variant:"success",title:"تم التحديث",message:"تم تحديث قائمتك بنجاح."}),A(!1),b(!1)}catch(s){S({variant:"alert",title:"خطأ",message:s.message})}finally{ae()}}})},Q=t.useMemo(()=>{const s=o?a:n,l=X(B);let m=s.filter(v=>l?X(v[f]).includes(l):!0);return!o&&p!=="all"&&(m=m.filter(v=>{const j=u.includes(v.id);return p==="selected"?j:!j})),m},[o,a,n,B,p,u,f]),U=o?F:u,k=Q.map(s=>s.id),ie=k.length>0&&k.every(s=>u.includes(s)),de=k.length===0||!k.some(s=>u.includes(s)),ge=()=>N(s=>[...new Set([...s,...k])]),me=()=>N(s=>s.filter(l=>!k.includes(l)));return e.jsx(J,{appear:!0,show:r,as:t.Fragment,children:e.jsxs(q,{as:"div",className:"relative z-50",onClose:()=>P?S({variant:"confirm",title:"تنبيه",message:"تغييرات غير محفوظة",onConfirm:c}):c(),dir:"rtl",children:[e.jsx(J.Child,{as:t.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-0 sm:p-4 text-center",children:e.jsx(J.Child,{as:t.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(q.Panel,{className:"w-full max-w-2xl transform overflow-hidden bg-gradient-to-br from-gray-900 to-gray-800 text-right shadow-2xl transition-all h-screen sm:h-auto sm:max-h-[80vh] sm:rounded-2xl border border-gray-700 flex flex-col",children:[e.jsxs(q.Title,{as:"h3",className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,className:"p-1.5 rounded-full text-gray-400 hover:bg-gray-700 transition-colors",children:e.jsx(fe,{className:"w-6 h-6"})}),o&&e.jsxs("button",{onClick:ne,className:"flex items-center gap-1 text-sm text-gray-400 hover:text-white px-2 py-1 rounded bg-gray-800 hover:bg-gray-700 transition-all border border-gray-600",children:[e.jsx(pe,{className:"w-4 h-4"})," عودة للاختيار"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-lg font-semibold text-gray-200 flex items-center gap-2",children:[o?"إدارة قائمة الدول":i,h&&e.jsx(be,{className:`w-5 h-5 ${o?"text-green-400":"text-[#FFD700]"}`})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!o&&h&&e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-800 text-gray-300 text-sm hover:bg-gray-700 hover:text-[#FFD700] border border-gray-600 transition-all",title:"إضافة/حذف دول من القائمة",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"إدارة القائمة"})]}),!o&&!R&&!h&&e.jsx("button",{onClick:()=>K(!0),className:"p-1.5 rounded-full text-gray-400 hover:text-[#FFD700]",children:e.jsx(ke,{className:"w-6 h-6"})})]})]}),o&&e.jsxs("div",{className:"bg-blue-900/30 border-b border-blue-800 p-2 text-center text-xs text-blue-200",children:["أنت الآن في وضع ",e.jsx("strong",{children:"إدارة القائمة"}),". الدول التي تحددها هنا ستظهر لك عند إنشاء المهام."]}),!o&&e.jsxs("div",{className:"p-3 border-b border-gray-700 bg-gray-900/30 flex flex-wrap justify-between gap-2 text-xs",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w("all"),className:`px-3 py-1 rounded ${p==="all"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,children:"الكل"}),e.jsx("button",{onClick:()=>w("selected"),className:`px-3 py-1 rounded ${p==="selected"?"bg-green-600 text-white":"bg-gray-700 text-gray-300"}`,children:"المختار"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ge,disabled:ie,className:"text-blue-400 hover:text-blue-300 disabled:opacity-50",children:"تحديد الكل"}),e.jsx("button",{onClick:me,disabled:de,className:"text-red-400 hover:text-red-300 disabled:opacity-50",children:"إلغاء الكل"})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:o?"ابحث في جميع الدول...":"ابحث في قائمتك...",value:B,onChange:s=>M(s.target.value),className:"w-full bg-gray-700 p-2.5 pr-10 rounded-md border border-gray-600 focus:ring-2 focus:ring-[#FFD700] text-gray-100 placeholder:text-gray-500"}),e.jsx(ye,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 space-y-2 min-h-[300px] bg-gray-800/50",children:g?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400 gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-500 border-t-[#FFD700] rounded-full animate-spin"}),e.jsx("span",{children:"جاري تحميل المكتبة الشاملة..."})]}):Q.length>0?Q.map(s=>{const l=U.includes(s.id),m=s.code?Y(s.code):null,v=o?"border-green-500/50 bg-green-500/10":"border-[#FFD700]/50 bg-[#FFD700]/10",j=o?"text-green-400":"text-[#FFD700]";return e.jsxs("div",{className:`flex items-center gap-2 p-2.5 rounded-lg border transition-all duration-200 ${l?v:"border-gray-700 bg-gray-800 hover:bg-gray-700"}`,children:[e.jsxs("label",{className:"flex-grow flex items-center gap-3 cursor-pointer w-full select-none",children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center transition-colors ${l?o?"bg-green-600 border-green-600":"bg-[#FFD700] border-[#FFD700]":"border-gray-500 bg-gray-900"}`,children:l&&e.jsx(ve,{className:`w-4 h-4 ${o?"text-white":"text-black"}`})}),e.jsx("input",{type:"checkbox",checked:l,onChange:()=>oe(s.id),className:"hidden"}),e.jsxs("span",{className:"text-gray-200 text-sm flex items-center gap-3 w-full",children:[m&&e.jsx("img",{src:m,alt:s.code,className:"w-6 h-4 object-cover rounded shadow-sm opacity-90",loading:"lazy"}),e.jsx("span",{className:l?`font-bold ${j}`:"",children:s[f]})]})]}),!R&&!h&&!o&&e.jsx("button",{onClick:()=>{},className:"p-1.5 text-gray-500 hover:text-red-400 hover:bg-gray-700 rounded transition-colors",children:e.jsx(Ce,{className:"w-5 h-5"})})]},s.id)}):e.jsxs("div",{className:"text-center text-gray-500 py-10 flex flex-col items-center gap-2",children:[e.jsx(Le,{className:"w-8 h-8 opacity-20"}),e.jsx("span",{children:o?"لا توجد نتائج في المكتبة.":"القائمة فارغة."}),!o&&h&&e.jsx("button",{onClick:G,className:"text-[#FFD700] text-sm underline mt-2 hover:text-yellow-300",children:"إضافة عناصر من المكتبة"})]})}),e.jsx("div",{className:"p-4 border-t border-gray-700 bg-gray-900 sticky bottom-0 z-10",children:e.jsx("button",{onClick:o?ce:le,disabled:g,className:`w-full py-3 rounded-lg font-bold transition-all flex items-center justify-center gap-2
                                            ${o?P?"bg-green-600 hover:bg-green-500 text-white":"bg-gray-700 text-gray-400":"bg-[#FFD700] hover:bg-yellow-400 text-black"}`,children:o?g?"جاري التحميل...":`حفظ القائمة الجديدة (${U.length})`:`تأكيد الاختيار للمهمة (${U.length})`})})]})})})})]})})}const We=({label:r,Icon:c,options:i,selectedValues:n,onChange:x,error:T,nameField:f="name",collectionName:_,readOnly:R=!1,dialogHook:H,actionLoadingHook:O,enableOrdering:Z=!1})=>{const[h,p]=t.useState(!1),[w,u]=t.useState(!1),N=_==="app_countries"?"ref_countries":void 0,F=()=>{const a=n.length;return a===0?"لم يتم تحديد أي عنصر":`تم تحديد ${a} عنصر`},y=t.useMemo(()=>{if(!i||!n||i.length===0)return[];const a=new Map(i.map(d=>[d.id,d]));return n.map(d=>a.get(d)).filter(Boolean)},[i,n]),o=a=>x(n.filter(d=>d!==a)),b=(a,d)=>{if(d==="up"&&a===0||d==="down"&&a===n.length-1)return;const g=[...n],C=g[a];d==="up"?(g[a]=g[a-1],g[a-1]=C):(g[a]=g[a+1],g[a+1]=C),x(g)};return e.jsxs(z.div,{variants:ue,className:`bg-gradient-to-br from-gray-900/60 to-gray-800/60 rounded-lg p-3 shadow-md border ${T?"border-red-500":"border-gray-700"} transition-colors duration-300 w-full`,children:[e.jsxs("label",{className:"flex items-center gap-2 mb-2 font-semibold text-gray-300 text-sm",children:[e.jsx(c,{className:"w-5 h-5 text-[#FFD700]"}),r]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{type:"button",onClick:()=>p(!0),className:"flex-grow w-full bg-gray-700/60 p-2.5 rounded-md border border-gray-600 flex justify-between items-center text-right hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-[#FFD700]",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx("span",{className:`text-sm ${n.length>0?"text-gray-200":"text-gray-500"}`,children:F()})]}),y.length>0&&e.jsx("button",{type:"button",onClick:()=>u(a=>!a),className:"flex-shrink-0 p-2.5 rounded-md text-gray-400 hover:text-[#FFD700] hover:bg-gray-700/60 border border-gray-600 bg-gray-700/60",children:e.jsx(z.div,{animate:{rotate:w?180:0},children:e.jsx(Se,{className:"w-5 h-5"})})})]}),e.jsx(xe,{children:w&&y.length>0&&e.jsx(z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1,paddingTop:"8px"},exit:{height:0,opacity:0,paddingTop:0},className:"overflow-hidden space-y-1.5 max-h-40 overflow-y-auto pr-1",children:y.map((a,d)=>{const g=a.code?Y(a.code):null;return e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300 bg-gray-700/50 p-1.5 px-3 rounded-md border border-gray-600/50",children:[e.jsxs("span",{className:"truncate flex items-center gap-2",title:a[f],children:[g&&e.jsx("img",{src:g,alt:a.code,className:"w-5 h-3 object-cover rounded-sm"}),a[f]]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1.5",children:[Z&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(d,"up"),disabled:d===0,className:"p-1 text-gray-400 hover:text-blue-400 disabled:opacity-50",children:"▲"}),e.jsx("button",{onClick:()=>b(d,"down"),disabled:d===y.length-1,className:"p-1 text-gray-400 hover:text-blue-400 disabled:opacity-50",children:"▼"}),e.jsx("span",{className:"h-4 w-px bg-gray-600 mx-0.5"})]}),e.jsx("button",{onClick:()=>o(a.id),className:"p-1 text-gray-500 hover:text-red-400",children:e.jsx(he,{className:"w-5 h-5"})})]})]},a.id)})})}),e.jsx(Ae,{isOpen:h,onClose:()=>p(!1),title:r,options:i||[],selectedIds:n,onSave:x,nameField:f,collectionName:_,readOnly:R,dialogHook:H,actionLoadingHook:O,enableOrdering:Z,libraryCollection:N})]})};export{Qe as F,We as M,Ae as S,Ue as a,ze as b,Je as c,qe as u};
