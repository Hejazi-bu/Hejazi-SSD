import{r as a,c as ss,b as ts,d as as,q as Se,w as rs,h as Fe,i as L,g as _e,o as Ce,k as e,m as D,s as De,x as se,p as Te,z as $e,as as Le,aJ as Ie,aq as Oe,at as Ae,A as ns,ap as is,L as Me,aL as ke,aA as Y,ar as ls,aM as Pe,aN as Be,aO as pe,aP as be,aH as os,M as ce,aw as Ee,aK as cs,n as ds,a9 as ms,j as Re,D as gs,E as xs}from"./index-DjQnKye2.js";import{u as us,a as hs,b as fs,c as ps,M as de,F as bs,S as ys}from"./AhmedSaeedShared-CxRPbuOS.js";import{F as vs}from"./FunnelIcon-D6Ykaui4.js";import{F as ws}from"./ChevronDownIcon-qIRIwReu.js";import{F as Je}from"./Squares2X2Icon-CvsrrMi5.js";import{F as ve}from"./TrashIcon-CBwyCsvA.js";import{F as js}from"./PencilIcon-u-NC4gBe.js";import{F as ye}from"./CheckIcon-DhFLW5ob.js";import{F as Ns}from"./PlusIcon-VqZkTY5V.js";function Ss({title:s,titleId:n,...o},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":n},o),s?a.createElement("title",{id:n},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0-3-3m3 3 3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const Fs=a.forwardRef(Ss);function _s({title:s,titleId:n,...o},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":n},o),s?a.createElement("title",{id:n},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 9 6-6m0 0 6 6m-6-6v12a6 6 0 0 1-12 0v-3"}))}const Ue=a.forwardRef(_s);function Cs({title:s,titleId:n,...o},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":n},o),s?a.createElement("title",{id:n},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 18.75 7.5-7.5 7.5 7.5"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 7.5-7.5 7.5 7.5"}))}const Ds=a.forwardRef(Cs);function Ts({title:s,titleId:n,...o},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":n},o),s?a.createElement("title",{id:n},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"}))}const $s=a.forwardRef(Ts);function ks({title:s,titleId:n,...o},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":n},o),s?a.createElement("title",{id:n},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}const Ve=a.forwardRef(ks);function Es({title:s,titleId:n,...o},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":n},o),s?a.createElement("title",{id:n},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"}))}const Rs=a.forwardRef(Es),Ls=()=>({toFirestore:s=>s,fromFirestore:(s,n)=>({id:s.id,...s.data(n)})}),Is=Ls(),me=s=>s.reduce((n,o)=>(n[o]=!0,n),{});function Os({task:s,isOpen:n,onClose:o,dialogHook:m,actionLoadingHook:I,allServices:c,allUniversities:T,allCountries:$,allPersons:k}){const{showActionLoading:U,hideActionLoading:O}=I,{showDialog:f}=m,[F,V]=a.useState(s.title),[w,A]=a.useState(s.sub_tasks||[]),[q,M]=a.useState(!1),[Z,W]=a.useState(s.title),[l,h]=a.useState(!1),[p,j]=a.useState(s.sub_tasks||[]),[E,H]=a.useState(""),[ee,P]=a.useState(!1),[y,G]=a.useState([]),[R,v]=a.useState([]),[N,te]=a.useState([]),[_,ae]=a.useState([]),[z,re]=a.useState(s.start_at?new Date(s.start_at.toDate()).toISOString().slice(0,16):""),[r,g]=a.useState(s.end_at?new Date(s.end_at.toDate()).toISOString().slice(0,16):""),[x,S]=a.useState({title:s.title,subTasks:s.sub_tasks||[],services:[],universities:[],countries:[],persons:[],startDate:s.start_at?new Date(s.start_at.toDate()).toISOString().slice(0,16):"",endDate:s.end_at?new Date(s.end_at.toDate()).toISOString().slice(0,16):""}),[we,ge]=a.useState(null),[xe,ue]=a.useState(!1),[he,fe]=a.useState(!1),[ne,je]=a.useState(s);a.useEffect(()=>{je(s)},[s]),a.useEffect(()=>{if(n){const t=(X,le,b)=>{if(!le||!X)return[];const J=new Map(le.map(oe=>[oe[b],oe.id]));return X.map(oe=>J.get(oe)).filter(Boolean)},i=t(s.services_list||[],c,"name"),d=t(s.universities_list||[],T,"name"),u=t(s.countries_list||[],$,"name_ar"),C=t(s.responsible_persons_list||[],k,"name"),Q=s.start_at?new Date(s.start_at.toDate()).toISOString().slice(0,16):"",K=s.end_at?new Date(s.end_at.toDate()).toISOString().slice(0,16):"";V(s.title),A(s.sub_tasks||[]),G(i),v(d),te(u),ae(C),re(Q),g(K),S({title:s.title,subTasks:s.sub_tasks||[],services:i,universities:d,countries:u,persons:C,startDate:Q,endDate:K}),M(!1),W(s.title),h(!1),j(s.sub_tasks||[]),H(""),P(!1),ge(null),ue(!1),fe(!1)}},[n,s,c,T,$,k]),a.useEffect(()=>{if(!n)return;const t=F!==x.title,i=JSON.stringify(w)!==JSON.stringify(x.subTasks),d=JSON.stringify(y)!==JSON.stringify(x.services),u=JSON.stringify(R)!==JSON.stringify(x.universities),C=JSON.stringify(N)!==JSON.stringify(x.countries),Q=JSON.stringify(_)!==JSON.stringify(x.persons),K=z!==x.startDate,X=r!==x.endDate;ue(t||i||d||u||C||Q||K||X)},[F,w,y,R,N,_,z,r,x,n]);const qe=()=>{const t=Re(Z);t?(V(t),M(!1)):f({variant:"alert",title:"خطأ",message:"العنوان لا يمكن أن يكون فارغاً."})},We=()=>{W(F),M(!1)},He=()=>{const t=Re(E);t&&(j(i=>[...i,{text:t,is_done:!1}]),H(""))},Qe=(t,i)=>{j(d=>d.map((u,C)=>C===t?{...u,text:i}:u))},Ze=t=>{j(i=>i.filter((d,u)=>u!==t))},Ne=t=>{l?j(i=>i.map((d,u)=>u===t?{...d,is_done:!d.is_done}:d)):A(i=>i.map((d,u)=>u===t?{...d,is_done:!d.is_done}:d))},ze=()=>{A(p),h(!1)},Ge=()=>{j(w),h(!1)},ie=(t,i,d,u)=>e.jsxs("div",{className:"bg-gray-800/50 p-3 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"flex items-center gap-1.5 text-sm font-semibold text-gray-300",children:[e.jsx(i,{className:"w-4 h-4 text-[#FFD700]"}),t]}),e.jsx("button",{onClick:()=>ge(u),className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",title:`تعديل ${t}`,children:e.jsx(ce,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:d&&d.length>0?d.map((C,Q)=>e.jsxs("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-300 text-xs rounded-full",children:[" ",C]},`${C}-${Q}`)):e.jsx("span",{className:"text-xs text-gray-500",children:"لا يوجد"})})]}),Ke=async()=>{if(he||!xe)return;if(y.length===0){f({variant:"alert",title:"بيانات ناقصة",message:"يجب اختيار خدمة واحدة على الأقل."});return}fe(!0),U("جاري حفظ التعديلات...");const t=y.map(b=>c?.find(J=>J.id===b)?.name||b),i=R.map(b=>T?.find(J=>J.id===b)?.name||b),d=N.map(b=>$?.find(J=>J.id===b)?.name_ar||b),u=_.map(b=>k?.find(J=>J.id===b)?.name||b),C=me(y),Q=me(R),K=me(N),X=me(_),le={title:F,sub_tasks:w,services_map:C,universities_map:Q,countries_map:K,responsible_persons_map:X,services_list:t,universities_list:i,countries_list:d,responsible_persons_list:u,start_at:z||null,end_at:r||null};try{await gs(xs,"updateAhmedSaeedTask")({taskId:s.id,taskData:le}),ue(!1),S({title:F,subTasks:w,services:y,universities:R,countries:N,persons:_,startDate:z,endDate:r}),f({variant:"success",title:"تم الحفظ",message:"تم حفظ التعديلات بنجاح."})}catch(b){f({variant:"alert",title:"خطأ",message:`فشل حفظ التعديلات: ${b.message}`})}finally{fe(!1),O()}},Xe=()=>{xe?f({variant:"confirm",title:"تعديلات غير محفوظة",message:"توجد تعديلات لم يتم حفظها. هل أنت متأكد من الخروج؟",onConfirm:o}):o()},Ye=async()=>{const t=ne.is_hidden||!1,i=t?"استعادة":"إخفاء";f({variant:"confirm",title:`تأكيد ${i}`,message:`هل أنت متأكد من ${i} هذه المهمة؟`,onConfirm:async()=>{U(`جاري ${i}...`);try{const d=Y(L,"AhmedSaeedTasks",s.id);await Pe(d,{is_hidden:!t}),je(u=>({...u,is_hidden:!t}))}catch(d){f({variant:"alert",title:"خطأ",message:d.message})}finally{O()}}})},es=()=>{f({variant:"confirm",customColor:"red",title:"تأكيد الحذف",message:`هل أنت متأكد من حذف هذه المهمة (${s.title}) بشكل نهائي؟ لا يمكن التراجع عن هذا الإجراء.`,confirmText:"نعم، احذف",cancelText:"إلغاء",onConfirm:async()=>{U("جاري حذف السجل...");try{const t=Y(L,"AhmedSaeedTasks",s.id);await Be(t),f({variant:"success",title:"تم الحذف",message:`تم حذف السجل "${s.title}" بنجاح.`}),o()}catch(t){f({variant:"alert",title:"خطأ",message:`فشل حذف السجل: ${t.message}`})}finally{O()}}})},B=(()=>{const t=` - (${s.title})`;switch(we){case"services":return{title:"تعديل الخدمات"+t,options:c||[],selectedIds:y,onSave:i=>G(i),collectionName:"app_services",readOnly:!1,nameField:"name",enableOrdering:!0};case"universities":return{title:"تعديل الجامعات"+t,options:T||[],selectedIds:R,onSave:i=>v(i),collectionName:"app_universities",readOnly:!1,nameField:"name",enableOrdering:!0};case"countries":return{title:"تعديل الدول"+t,options:$||[],selectedIds:N,onSave:i=>te(i),collectionName:"app_countries",readOnly:!1,nameField:"name_ar",enableOrdering:!0};case"persons":return{title:"تعديل الأشخاص المسؤولين"+t,options:k||[],selectedIds:_,onSave:i=>ae(i),collectionName:"app_responsible_persons",readOnly:!1,nameField:"name",enableOrdering:!0};default:return null}})();return e.jsxs(e.Fragment,{children:[e.jsx(pe,{appear:!0,show:n,as:a.Fragment,children:e.jsxs(be,{as:"div",className:"relative z-50",onClose:()=>{},dir:"rtl",children:[e.jsx(pe.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-0 sm:p-4 text-center",children:e.jsx(pe.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(be.Panel,{className:"w-full max-w-2xl transform overflow-hidden bg-gradient-to-br from-gray-900 to-gray-800 text-right shadow-2xl transition-all h-screen sm:h-auto sm:max-h-[80vh] sm:rounded-2xl border border-gray-700 flex flex-col",children:[e.jsxs(be.Title,{as:"h3",className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("button",{onClick:Xe,className:"p-1.5 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",children:e.jsx(Le,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-lg font-semibold text-gray-200 truncate pr-4",children:"تفاصيل المهمة"})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-800/50 p-3 rounded-lg border border-gray-700",children:[e.jsxs("h4",{className:"flex items-center gap-1.5 text-sm font-semibold text-gray-300 mb-2",children:[e.jsx(os,{className:"w-4 h-4 text-[#FFD700]"}),"الرقم المتسلسل"]}),e.jsx("p",{className:"w-full p-2.5 text-gray-200",children:s.sequence_number||"غير محدد"})]}),e.jsxs("div",{className:"bg-gray-800/50 p-3 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"flex items-center gap-1.5 text-sm font-semibold text-gray-300",children:[e.jsx(js,{className:"w-4 h-4 text-[#FFD700]"}),"عنوان المهمة"]}),q?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:We,className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-red-400 transition-colors",title:"إلغاء",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:qe,className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-green-400 transition-colors",title:"حفظ العنوان",children:e.jsx(ye,{className:"w-5 h-5"})})]}):e.jsx("button",{onClick:()=>M(!0),className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",title:"تعديل العنوان",children:e.jsx(ce,{className:"w-5 h-5"})})]}),q?e.jsx("input",{type:"text",value:Z,onChange:t=>W(t.target.value),className:"w-full bg-gray-700 p-2.5 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700] text-gray-100",autoFocus:!0}):e.jsx("p",{className:"w-full p-2.5 text-gray-200",children:F})]}),e.jsxs("div",{className:"bg-gray-800/50 p-3 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"flex items-center gap-1.5 text-sm font-semibold text-gray-300",children:[e.jsx(cs,{className:"w-4 h-4 text-[#FFD700]"}),"التواريخ (اختياري)"]}),ee?e.jsx("button",{onClick:()=>P(!1),className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-green-400 transition-colors",title:"إغلاق التعديل",children:e.jsx(ye,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>P(!0),className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",title:"تعديل التواريخ",children:e.jsx(ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"تاريخ البدء"}),e.jsx("input",{type:"datetime-local",value:z,onChange:t=>re(t.target.value),disabled:!ee,className:"w-full bg-gray-700 p-2.5 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700] [color-scheme:dark] text-gray-200 disabled:bg-gray-800 disabled:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"تاريخ الانتهاء"}),e.jsx("input",{type:"datetime-local",value:r,onChange:t=>g(t.target.value),disabled:!ee,className:"w-full bg-gray-700 p-2.5 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700] [color-scheme:dark] text-gray-200 disabled:bg-gray-800 disabled:text-gray-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 p-3 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"flex items-center gap-1.5 text-sm font-semibold text-gray-300",children:[e.jsx(bs,{className:"w-4 h-4 text-[#FFD700]"}),"المهام الفرعية"]}),l?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Ge,className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-red-400 transition-colors",title:"إلغاء",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ze,className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-green-400 transition-colors",title:"حفظ المهام",children:e.jsx(ye,{className:"w-5 h-5"})})]}):e.jsx("button",{onClick:()=>h(!0),className:"p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",title:"تعديل المهام",children:e.jsx(ce,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"space-y-2",children:l?e.jsxs(e.Fragment,{children:[p.map((t,i)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.is_done,onChange:()=>Ne(i),className:`form-checkbox h-5 w-5 bg-gray-700 border-gray-600 ${t.is_done?"text-green-500":"text-[#FFD700]"} focus:ring-green-500 rounded mt-2 cursor-pointer`}),e.jsx("textarea",{value:t.text,onChange:d=>Qe(i,d.target.value),rows:2,className:`flex-grow w-full bg-gray-700 p-2.5 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700] text-sm ${t.is_done?"text-gray-500":"text-gray-200"}`}),e.jsx("button",{onClick:()=>Ze(i),className:"p-2.5 text-gray-400 hover:text-red-400 transition-colors mt-0.5",title:"حذف المهمة",children:e.jsx(ve,{className:"w-5 h-5"})})]},i)),p.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center p-2",children:"لا توجد مهام فرعية."}),e.jsxs("div",{className:"flex items-start gap-2 pt-3 border-t border-gray-700 mt-3",children:[e.jsx("textarea",{placeholder:"أضف مهمة فرعية جديدة...",value:E,onChange:t=>H(t.target.value),rows:2,className:"flex-grow w-full bg-gray-700 p-2.5 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700] text-sm text-gray-200"}),e.jsx("button",{type:"button",onClick:He,className:"flex-shrink-0 bg-[#FFD700] text-black px-4 py-2.5 rounded-lg font-bold disabled:bg-gray-600 disabled:text-gray-400",disabled:!E.trim(),title:"إضافة مهمة",children:e.jsx(Ns,{className:"w-5 h-5"})})]})]}):e.jsx(e.Fragment,{children:w.length>0?w.map((t,i)=>e.jsxs("label",{className:"flex items-start gap-3 p-2.5 rounded-md cursor-pointer hover:bg-gray-700/50",children:[e.jsx("input",{type:"checkbox",checked:t.is_done,onChange:()=>Ne(i),className:`form-checkbox h-5 w-5 bg-gray-700 border-gray-600 ${t.is_done?"text-green-500":"text-[#FFD700]"} focus:ring-green-500 rounded mt-0.5 cursor-pointer`}),e.jsx("span",{className:`text-sm ${t.is_done?"text-gray-500 line-through":"text-gray-200"}`,children:t.text})]},i)):e.jsx("p",{className:"text-sm text-gray-500 text-center p-2",children:"لا توجد مهام فرعية."})})})]}),ie("الخدمات",Je,y.map(t=>c?.find(i=>i.id===t)?.name||t),"services"),ie("الجامعات",Ie,R.map(t=>T?.find(i=>i.id===t)?.name||t),"universities"),ie("الدول",Oe,N.map(t=>$?.find(i=>i.id===t)?.name_ar||t),"countries"),ie("الأشخاص المسؤولون",Ae,_.map(t=>k?.find(i=>i.id===t)?.name||t),"persons")]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 bg-gray-900/30 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Ye,className:`flex items-center gap-1.5 text-xs transition-colors font-medium ${ne.is_hidden?"text-blue-400 hover:text-blue-300":"text-gray-500 hover:text-gray-400"}`,children:[ne.is_hidden?e.jsx(Ue,{className:"w-4 h-4"}):e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:ne.is_hidden?"استعادة":"إخفاء"})]}),e.jsxs("button",{onClick:es,className:"flex items-center gap-1.5 text-xs text-red-500 hover:text-red-400 transition-colors font-medium",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"حذف السجل"})]})]}),e.jsxs(D.button,{variants:ds,whileHover:"hover",whileTap:"tap",onClick:Ke,disabled:!xe||he,className:"flex items-center gap-2 bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ms,{className:"w-5 h-5"}),e.jsx("span",{children:he?"جاري الحفظ...":"حفظ التعديلات"})]})]})]})})})})]})}),B&&e.jsx(ys,{isOpen:!!we,onClose:()=>ge(null),title:B.title,options:B.options,selectedIds:B.selectedIds,onSave:B.onSave,nameField:B.nameField,collectionName:B.collectionName,readOnly:B.readOnly,dialogHook:m,actionLoadingHook:I,enableOrdering:B.enableOrdering})]})}const As=({task:s,dialogHook:n,actionLoadingHook:o,allServices:m,allUniversities:I,allCountries:c,allPersons:T,showHidden:$,isSelected:k,onToggleSelection:U,displayIndex:O,totalTasks:f})=>{const[F,V]=a.useState(!1),{showActionLoading:w,hideActionLoading:A}={...n,...o},q=l=>{if(!l)return"-";const h=l.toDate(),p={year:"numeric",month:"numeric",day:"numeric"};return new Date(h).toLocaleString("ar-EG-u-nu-latn",p)},M=l=>{if(!l)return"-";const h=l.toDate(),p={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"};return new Date(h).toLocaleString("ar-EG-u-nu-latn",p)},Z=async l=>{l.stopPropagation();const h=s.is_hidden||!1,p=h?"استعادة":"إخفاء";n.showDialog({variant:"confirm",title:`تأكيد ${p}`,message:`هل أنت متأكد من ${p} هذه المهمة؟`,onConfirm:async()=>{w(`جاري ${p}...`);try{const j=Y(L,"AhmedSaeedTasks",s.id);await Pe(j,{is_hidden:!h})}catch(j){n.showDialog({variant:"alert",title:"خطأ",message:j.message})}finally{A()}}})},W=l=>{l.stopPropagation(),n.showDialog({variant:"confirm",customColor:"red",title:"تأكيد الحذف",message:`هل أنت متأكد من حذف هذه المهمة (${s.title}) بشكل نهائي؟`,confirmText:"نعم، احذف",cancelText:"إلغاء",onConfirm:async()=>{w("جاري حذف السجل...");try{const h=Y(L,"AhmedSaeedTasks",s.id);await Be(h),n.showDialog({variant:"success",title:"تم الحذف",message:`تم حذف السجل "${s.title}" بنجاح.`})}catch(h){n.showDialog({variant:"alert",title:"خطأ",message:`فشل حذف السجل: ${h.message}`})}finally{A()}}})};return e.jsxs(e.Fragment,{children:[e.jsxs(D.div,{variants:se,className:`rounded-xl border shadow-lg flex flex-col transition-colors duration-200 ${k?"bg-gray-700 border-yellow-500":"bg-gray-800/60 border-gray-700"}`,children:[e.jsx("div",{className:"p-4 flex-grow",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[$?e.jsx("input",{type:"checkbox",checked:k,onChange:()=>U(s.id),className:"form-checkbox h-5 w-5 bg-gray-700 border-gray-600 text-[#FFD700] focus:ring-[#FFD700] rounded mt-1 flex-shrink-0"}):e.jsx("span",{className:"text-sm font-bold text-gray-500 mt-1",title:`الترتيب: ${f-O} من ${f}`,children:f-O}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1 text-right flex-1 mx-2",children:s.title})]})}),(s.start_at||s.end_at)&&e.jsxs("div",{className:"pt-2 pb-2 px-4 border-t border-gray-700/50 bg-gray-800/30 text-xs text-gray-400 grid grid-cols-2 gap-2",dir:"rtl",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-semibold text-gray-500",children:"يبدأ في:"}),e.jsx("span",{className:"font-sans ml-1",children:M(s.start_at)})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-semibold text-gray-500",children:"ينتهي في:"}),e.jsx("span",{className:"font-sans ml-1",children:M(s.end_at)})]})]}),e.jsxs("div",{className:"pt-3 pb-3 px-4 border-t border-gray-700 bg-gray-900/20 rounded-b-xl flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>V(!0),className:"text-gray-400 hover:text-[#FFD700] transition-colors",title:"عرض التفاصيل والتعديل",children:e.jsx(Me,{className:"w-5 h-5"})}),s.status==="منجز"?e.jsx(ls,{className:"w-5 h-5 text-green-500",title:"منجز"}):e.jsx($s,{className:"w-5 h-5 text-yellow-500",title:"غير منجز"})]}),e.jsx("p",{className:"text-xs text-gray-500 font-sans",title:q(s.created_at),children:q(s.created_at)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:Z,className:`transition-colors ${s.is_hidden?"text-blue-400 hover:text-blue-300":"text-gray-500 hover:text-gray-400"}`,title:s.is_hidden?"استعادة":"إخفاء",children:s.is_hidden?e.jsx(Ue,{className:"w-5 h-5"}):e.jsx(Ve,{className:"w-5 h-5"})}),e.jsx("button",{onClick:W,className:"text-gray-500 hover:text-red-400 transition-colors",title:"حذف السجل",children:e.jsx(ve,{className:"w-5 h-5"})})]})]})]}),e.jsx(Os,{task:s,isOpen:F,onClose:()=>V(!1),dialogHook:n,actionLoadingHook:o,allServices:m,allUniversities:I,allCountries:c,allPersons:T})]})},Ms=({tasks:s,activeFilter:n,onFilterChange:o})=>{const m=a.useMemo(()=>({all:s.length,done:s.filter(c=>c.status==="منجز").length,pending:s.filter(c=>c.status==="غير منجز").length}),[s]),I=[{label:"الكل",filter:"all",count:m.all},{label:"غير منجز",filter:"غير منجز",count:m.pending},{label:"منجز",filter:"منجز",count:m.done}];return e.jsx("div",{className:"flex items-center gap-2",children:I.map(c=>e.jsxs("button",{onClick:()=>o(c.filter),className:`px-4 py-2 rounded-lg text-sm font-semibold transition-colors ${n===c.filter?"bg-[#FFD700] text-black":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:[c.label,e.jsx("span",{className:`mr-2 px-2 py-0.5 rounded-full text-xs ${n===c.filter?"bg-black/20":"bg-gray-600/50"}`,children:c.count})]},c.filter))})};function zs(){const{setPageLoading:s}=ss(),n=ts(),o=as(),{showActionLoading:m,hideActionLoading:I}=o,[c,T]=a.useState(!1),[$,k]=a.useState(!1),{allCountries:U,countriesLoading:O}=us(),{allServices:f,servicesLoading:F}=hs(),{allUniversities:V,universitiesLoading:w}=fs(),{allPersons:A,personsLoading:q}=ps(),M=a.useMemo(()=>Se(Fe(L,"AhmedSaeedTasks"),rs("is_hidden","==",!0)),[]),[Z]=_e(M),W=Z?Z.length:0,[l,h]=a.useState({services:[],universities:[],countries:[],responsiblePersons:[]}),[p,j]=a.useState("all"),[E,H]=a.useState([]),ee=a.useMemo(()=>{const r=Fe(L,"AhmedSaeedTasks").withConverter(Is);return Se(r,Ce("sequence_number","desc"),Ce("created_at","desc"))},[]),[P,y,G]=_e(ee),R=a.useMemo(()=>P||[],[P]);a.useEffect(()=>{H([])},[c]);const v=a.useMemo(()=>R.filter(r=>{const g=r.is_hidden===!0;return!(c&&!g||!c&&g||p!=="all"&&r.status!==p||l.services.length>0&&!l.services.every(S=>r.services_map&&r.services_map[S]===!0)||l.universities.length>0&&!l.universities.every(S=>r.universities_map&&r.universities_map[S]===!0)||l.countries.length>0&&!l.countries.every(S=>r.countries_map&&r.countries_map[S]===!0)||l.responsiblePersons.length>0&&!l.responsiblePersons.every(S=>r.responsible_persons_map&&r.responsible_persons_map[S]===!0))}),[R,p,l,c]);a.useEffect(()=>{s(O||F||w||q||y)},[O,F,w,q,y,s]);const N=(r,g)=>{h(x=>({...x,[r]:g}))},te=()=>{h({services:[],universities:[],countries:[],responsiblePersons:[]}),j("all")},_=l.services.length>0||l.universities.length>0||l.countries.length>0||l.responsiblePersons.length>0,ae=r=>{H(g=>g.includes(r)?g.filter(x=>x!==r):[...g,r])},z=()=>{E.length!==0&&n.showDialog({variant:"confirm",title:`استعادة ${E.length} سجلات`,message:"هل أنت متأكد من استعادة السجلات المحددة؟",onConfirm:async()=>{m("جاري استعادة السجلات...");try{const r=ke(L);E.forEach(g=>{const x=Y(L,"AhmedSaeedTasks",g);r.update(x,{is_hidden:!1})}),await r.commit(),H([])}catch(r){n.showDialog({variant:"alert",title:"خطأ",message:r.message})}finally{I()}}})},re=()=>{const r=v.map(g=>g.id);r.length!==0&&n.showDialog({variant:"confirm",title:`استعادة كل السجلات (${r.length})`,message:"هل أنت متأكد من استعادة جميع السجلات المخفية؟",onConfirm:async()=>{m("جاري استعادة الكل...");try{const g=ke(L);r.forEach(x=>{const S=Y(L,"AhmedSaeedTasks",x);g.update(S,{is_hidden:!1})}),await g.commit(),H([])}catch(g){n.showDialog({variant:"alert",title:"خطأ",message:g.message})}finally{I()}}})};return e.jsxs(D.div,{dir:"rtl",variants:De,initial:"initial",animate:"animate",className:"space-y-6",children:[e.jsxs(D.div,{variants:se,className:"bg-gray-800/50 rounded-xl border border-gray-700",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center p-4 gap-4 cursor-pointer",onClick:()=>k(r=>!r),children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-bold text-[#FFD700]",children:[e.jsx(vs,{className:"w-6 h-6"}),"فلترة السجلات",_&&e.jsx(Te,{className:"w-5 h-5 text-blue-400",title:"يوجد فلترة نشطة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsxs(D.button,{variants:$e,initial:"initial",animate:"animate",onClick:r=>{r.stopPropagation(),te()},className:"flex items-center gap-1 text-sm text-red-400 hover:text-red-300 transition-colors",children:[e.jsx(Le,{className:"w-5 h-5"}),"إلغاء الفلاتر"]}),e.jsx(D.div,{animate:{rotate:$?180:0},children:e.jsx(ws,{className:"w-6 h-6 text-gray-400"})})]})]}),$&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4 pt-0 border-t border-gray-700/50",children:[e.jsx(de,{label:"الخدمات",Icon:Je,options:f,selectedValues:l.services,onChange:r=>N("services",r),collectionName:"app_services",dialogHook:n,actionLoadingHook:o}),e.jsx(de,{label:"الجامعات",Icon:Ie,options:V,selectedValues:l.universities,onChange:r=>N("universities",r),collectionName:"app_universities",dialogHook:n,actionLoadingHook:o}),e.jsx(de,{label:"الدول",Icon:Oe,options:U,selectedValues:l.countries,onChange:r=>N("countries",r),collectionName:"countries",readOnly:!0,nameField:"name_ar",dialogHook:n,actionLoadingHook:o}),e.jsx(de,{label:"الأشخاص المسؤولون",Icon:Ae,options:A,selectedValues:l.responsiblePersons,onChange:r=>N("responsiblePersons",r),collectionName:"app_responsible_persons",dialogHook:n,actionLoadingHook:o})]})]}),e.jsx(ns,{children:c&&e.jsxs(D.div,{variants:$e,initial:"initial",animate:"animate",exit:"exit",className:"bg-blue-900/30 border border-blue-700 rounded-xl p-3 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-300",children:"أنت تعرض السجلات المخفية."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:re,disabled:v.length===0,className:"flex items-center gap-1.5 text-xs text-yellow-300 hover:text-yellow-200 disabled:text-gray-600 disabled:cursor-not-allowed",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsxs("span",{children:["استعادة الكل (",v.length,")"]})]}),e.jsxs("button",{onClick:z,disabled:E.length===0,className:"flex items-center gap-1.5 text-xs text-green-400 hover:text-green-300 disabled:text-gray-600 disabled:cursor-not-allowed",children:[e.jsx(Ds,{className:"w-4 h-4"}),e.jsxs("span",{children:["استعادة المحدد (",E.length,")"]})]})]})]})}),e.jsxs(D.div,{variants:se,className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("h2",{className:"text-lg text-gray-200 font-semibold flex items-center gap-2",children:[e.jsx("span",{children:c?"السجلات المخفية":"السجلات النشطة"}),e.jsxs("span",{className:"text-lg font-bold text-white",children:["(",c?W:P?P.filter(r=>!r.is_hidden).length:0,")"]}),_&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-400",title:"يتم عرض السجلات المفلترة فقط",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-lg font-bold",children:["(",v.length,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-900/50 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>T(!1),className:`flex items-center gap-1.5 text-sm font-medium px-4 py-2 rounded-lg transition-colors ${c?"text-gray-300 hover:bg-gray-700":"bg-yellow-500 text-black"}`,children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"النشطة"})]}),e.jsxs("button",{onClick:()=>T(!0),className:`flex items-center gap-1.5 text-sm font-medium px-4 py-2 rounded-lg transition-colors ${c?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700"}`,children:[e.jsx(Fs,{className:"w-5 h-5"}),e.jsxs("span",{children:["المخفية (",W,")"]})]})]})]}),e.jsx(D.div,{variants:se,className:"flex justify-between items-center",children:e.jsx(Ms,{tasks:v,activeFilter:p,onFilterChange:j})}),e.jsx(D.div,{variants:De,className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:!y&&v&&v.length>0&&v.map((r,g)=>e.jsx(As,{task:r,dialogHook:n,actionLoadingHook:o,allServices:f,allUniversities:V,allCountries:U,allPersons:A,showHidden:c,isSelected:E.includes(r.id),onToggleSelection:ae,displayIndex:g,totalTasks:v.length},r.id))}),e.jsxs(D.div,{variants:se,children:[y&&e.jsx("div",{className:"text-center p-10 text-gray-400",children:"جاري تحميل السجلات..."}),!y&&G&&e.jsxs("div",{className:"text-center p-10 text-red-400",children:[e.jsx("p",{children:"حدث خطأ أثناء جلب البيانات:"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",dir:"ltr",children:G.message}),e.jsx("p",{className:"mt-4 text-sm text-yellow-300",children:"⚠️ **تذكير:** قد يتطلب الفرز (orderBy) فهرساً بسيطاً لـ `sequence_number` و `created_at`."})]}),!y&&!G&&(!v||v.length===0)&&e.jsxs("div",{className:"text-center p-10 text-gray-500 bg-gray-800/50 rounded-xl border border-gray-700",children:[e.jsx(Rs,{className:"w-12 h-12 mx-auto mb-2"}),"لا توجد سجلات تطابق شروط الفلترة الحالية."]})]})]})}export{zs as default};
