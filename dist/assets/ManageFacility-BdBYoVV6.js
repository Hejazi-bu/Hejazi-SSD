import{r,J as Be,u as Ne,k as e,H as Ve,h as Q,i as J,q as M,w as F,N as ee,az as Ce,aA as Ee,A as Ze,m as me,aB as Ge,au as Ke,b as Ue,d as We,aC as Ye,s as qe,z as Xe,n as Qe,M as et,D as Le,E as Ae}from"./index-AlbxRJrk.js";import{F as Te}from"./MapPinIcon-Dkd4wD6-.js";import{F as Oe}from"./CheckIcon-DcCdwqXo.js";import{F as tt,a as rt}from"./TrashIcon-DqVoRP7K.js";import{F as at}from"./ChevronLeftIcon-CoSclDdo.js";import{F as st}from"./ChevronRightIcon-CG6pqeHi.js";function nt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"}))}const ot=r.forwardRef(nt);function lt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3"}))}const $e=r.forwardRef(lt);function ct({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"}))}const it=r.forwardRef(ct);function dt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"}))}const ut=r.forwardRef(dt);function gt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m6.115 5.19.319 1.913A6 6 0 0 0 8.11 10.36L9.75 12l-.387.775c-.217.433-.132.956.21 1.298l1.348 1.348c.21.21.329.497.329.795v1.089c0 .426.24.815.622 1.006l.153.076c.433.217.956.132 1.298-.21l.723-.723a8.7 8.7 0 0 0 2.288-4.042 1.087 1.087 0 0 0-.358-1.099l-1.33-1.108c-.251-.21-.582-.299-.905-.245l-1.17.195a1.125 1.125 0 0 1-.98-.314l-.295-.295a1.125 1.125 0 0 1 0-1.591l.13-.132a1.125 1.125 0 0 1 1.3-.21l.603.302a.809.809 0 0 0 1.086-1.086L14.25 7.5l1.256-.837a4.5 4.5 0 0 0 1.528-1.732l.146-.292M6.115 5.19A9 9 0 1 0 17.18 4.64M6.115 5.19A8.965 8.965 0 0 1 12 3c1.929 0 3.716.607 5.18 1.64"}))}const mt=r.forwardRef(gt);function ft({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))}const xt=r.forwardRef(ft);function bt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const oe=r.forwardRef(bt);function pt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122"}))}const ht=r.forwardRef(pt);function yt({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"}))}const ve=r.forwardRef(yt);function _t({title:a,titleId:o,...d},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},d),a?r.createElement("title",{id:o},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6Z"}))}const vt=r.forwardRef(_t),G={country:{label_ar:"Ø§Ù„Ø¨Ù„Ø¯Ø§Ù†",label_en:"Countries",child_target:"emirate",parent_target:null,collection:"ref_countries",icon:mt,geoInputType:"external_global"},emirate:{label_ar:"Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª",label_en:"Emirates",child_target:"region",parent_target:"country",collection:"ref_emirates",icon:oe,geoInputType:"external_global"},region:{label_ar:"Ø§Ù„Ù…Ù†Ø§Ø·Ù‚",label_en:"Regions",child_target:"city",parent_target:"emirate",collection:"ref_regions",icon:oe,geoInputType:"external_global"},city:{label_ar:"Ø§Ù„Ù…Ø¯Ù†",label_en:"Cities",child_target:"district",parent_target:"region",collection:"ref_cities",icon:oe,geoInputType:"external_global"},district:{label_ar:"Ø§Ù„Ø£Ø­ÙŠØ§Ø¡",label_en:"Districts",child_target:"sector",parent_target:"city",collection:"ref_districts",icon:oe,geoInputType:"none"},sector:{label_ar:"Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª",label_en:"Sectors",child_target:"site",parent_target:"district",collection:"ref_sectors",icon:oe,geoInputType:"none"},site:{label_ar:"Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹",label_en:"Sites",child_target:"building",parent_target:"sector",collection:"sites",icon:Te,hasType:!0,geoInputType:"external_global"},building:{label_ar:"Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ",label_en:"Buildings",child_target:"zone",parent_target:"site",collection:"buildings",icon:Be,hasType:!0,geoInputType:"external_global"},zone:{label_ar:"Ø§Ù„Ù…Ù†Ø§Ø·Ù‚",label_en:"Zones",child_target:"floor",parent_target:"building",parent_targets:["building","site"],collection:"zones",icon:vt,hasType:!0,geoInputType:"internal_unit"},floor:{label_ar:"Ø§Ù„Ø·ÙˆØ§Ø¨Ù‚",label_en:"Floors",child_target:"unit",parent_target:"zone",collection:"floors",icon:ht,geoInputType:"internal_floor"},unit:{label_ar:"Ø§Ù„ÙˆØ­Ø¯Ø§Øª / Ø§Ù„ØºØ±Ù",label_en:"Units / Rooms",child_target:"point",parent_target:"floor",parent_targets:["floor","zone"],collection:"units",icon:xt,hasType:!0,geoInputType:"internal_unit"},point:{label_ar:"Ù†Ù‚Ø§Ø· Ø§Ù„Ø£ØµÙˆÙ„",label_en:"Asset Points",child_target:null,parent_target:"unit",collection:"points",icon:ot,hasType:!0,geoInputType:"internal_unit"}},Ie=({code:a,collectionName:o})=>{const d=["countries","emirates","regions","ref_cities","ref_districts","ref_sectors"].includes(o);return!a||a.length!==2||!d?null:e.jsx("img",{src:`https://flagcdn.com/w40/${a.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w80/${a.toLowerCase()}.png 2x`,width:"24",alt:a,className:"rounded-sm object-cover shadow-sm",style:{display:"inline-block",marginRight:"8px",marginLeft:"8px"}})};function ge({collectionName:a,parentFilter:o,onSelect:d,label:i,placeholder:c,initialValue:v}){const{language:s}=Ne(),[S,E]=r.useState([]),[R,l]=r.useState([]),[u,N]=r.useState(!1),[L,P]=r.useState(""),[A,T]=r.useState(void 0),[j,K]=r.useState(""),[U,z]=r.useState(!1),$=r.useRef(null);r.useEffect(()=>{v&&v.name_ar?(P(s==="ar"?v.name_ar:v.name_en),T(v.code)):(P(""),T(void 0))},[v,s]),r.useEffect(()=>{const m=async()=>{z(!0);try{const O=Q(J,a);let W;if(o&&o.value)W=M(O,F(o.field,"==",o.value),F("is_active","==",!0));else if(o&&!o.value){E([]),l([]),z(!1);return}else W=M(O,F("is_active","==",!0));const Y=(await ee(W)).docs.map(B=>({id:B.id,...B.data()}));E(Y),l(Y)}catch(O){console.error("Error fetching reference data:",O)}finally{z(!1)}},y=["ref_cities","ref_districts","ref_sectors"].includes(a);a&&(!y||o&&o.value)?m():y&&!o?.value&&(E([]),l([]))},[a,o]),r.useEffect(()=>{if(!j)l(S);else{const m=j.toLowerCase();l(S.filter(y=>y.name_ar&&y.name_ar.includes(j)||y.name_en&&y.name_en.toLowerCase().includes(m)||y.code&&y.code.toLowerCase().includes(m)))}},[j,S]),r.useEffect(()=>{const m=y=>{$.current&&!$.current.contains(y.target)&&N(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const H=m=>{d(m),P(s==="ar"?m.name_ar:m.name_en),T(m.code),N(!1),K("")};return e.jsxs("div",{className:"relative",ref:$,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:i}),e.jsxs("button",{type:"button",onClick:()=>N(!u),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2.5 text-right text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none flex items-center justify-between transition-colors hover:bg-gray-700",children:[e.jsxs("div",{className:"flex items-center overflow-hidden",children:[e.jsx(Ie,{code:A,collectionName:a}),e.jsx("span",{className:`truncate ${L?"text-white font-medium":"text-gray-400"}`,children:L||c})]}),e.jsx(it,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),u&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full bg-[#1a2b42] border border-gray-600 rounded-lg shadow-xl max-h-60 overflow-auto scrollbar-thin scrollbar-thumb-[#FFD700]/30 animate-in fade-in zoom-in-95 duration-100",children:[e.jsx("div",{className:"sticky top-0 bg-[#1a2b42] p-2 border-b border-gray-700 z-10",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute right-3 top-2.5 w-4 h-4 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"text",className:"w-full bg-gray-800 border border-gray-600 rounded text-sm text-white px-8 py-2 focus:outline-none focus:border-[#FFD700]",placeholder:s==="ar"?"Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§...":"Search here...",value:j,onChange:m=>K(m.target.value),autoFocus:!0})]})}),U?e.jsxs("div",{className:"p-4 text-center text-gray-400 text-sm flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),s==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...":"Loading..."]}):R.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:s==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©":"No results found"}):e.jsx("ul",{children:R.map(m=>e.jsxs("li",{onClick:()=>H(m),className:"px-4 py-3 hover:bg-gray-700 cursor-pointer border-b border-gray-700/50 last:border-0 flex justify-between items-center group transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{code:m.code,collectionName:a}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium group-hover:text-[#FFD700] transition-colors",children:s==="ar"?m.name_ar:m.name_en}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[s==="ar"?m.name_en:m.name_ar,m.code&&e.jsx("span",{className:"mx-2 px-1.5 bg-gray-800 rounded text-gray-400 font-mono",children:m.code})]})]})]}),L===(s==="ar"?m.name_ar:m.name_en)&&e.jsx(Oe,{className:"w-5 h-5 text-[#FFD700]"})]},m.id))})]})]})}const wt=["country","emirate","region","city","district","sector"],Re="ADM",Nt="UAE",jt="AUH";function we(a){if(a==null||Number.isNaN(a))return null;if(typeof a!="object")return a;if(Array.isArray(a))return a.map(d=>we(d)).filter(d=>d!==null);const o={};return Object.keys(a).forEach(d=>{const i=we(a[d]);i!==null&&(o[d]=i)}),o}function Ft({itemData:a,language:o}){const d=wt.map(c=>{const v=`${c}_id`,s=`${c}_name_ar`;return a[v]&&a[s]?{label:G[c].label_ar,name:a[s],code:a[`${c}_code`]}:null}).filter(c=>c!==null);return["site","building","zone","floor","unit"].forEach(c=>{const v=`${c}_id`,s=`${c}_name_ar`;a[v]&&a[s]&&!d.some(S=>S&&S.label===G[c].label_ar)&&d.push({label:G[c].label_ar,name:a[s],code:a[`${c}_code`]})}),d.length===0?null:e.jsxs("div",{className:"space-y-3 bg-gray-800/30 p-4 rounded-lg border border-gray-700",children:[e.jsxs("h4",{className:"text-[#FFD700] text-sm font-bold flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),o==="ar"?"Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„":"Registered Geographic Location"]}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:d.map((c,v)=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-400 font-medium",children:[c.label,":"]}),e.jsx("span",{className:"text-white font-semibold",children:c.name})]},v))})]})}function St({isOpen:a,onClose:o,onSubmit:d,target:i,parentId:c,parentReferenceId:v,initialData:s,isSubmitting:S,isAddingOutdoorZone:E=!1,isAddingOutdoorUnit:R=!1}){const{language:l}=Ne(),u=G[i],[N,L]=r.useState(""),[P,A]=r.useState(""),[T,j]=r.useState(""),[K,U]=r.useState(""),[z,$]=r.useState(null),[H,m]=r.useState("operational"),[y,O]=r.useState(0),[W,te]=r.useState([]),[Y,B]=r.useState(null),[le,re]=r.useState(null),[ce,q]=r.useState(null),[ne,n]=r.useState(null),[x,b]=r.useState(null),[w,k]=r.useState(""),[D,ie]=r.useState(""),[X,V]=r.useState(""),[_,ae]=r.useState(""),[fe,je]=r.useState(""),[de,xe]=r.useState(""),[ue,be]=r.useState(""),pe=!!u.referenceCollection,C=i==="site",Fe=i==="floor",ze=E||R,De=[{value:"operational",label_ar:"ÙŠØ¹Ù…Ù„ / Ù…ØªØ§Ø­",label_en:"Operational / Active"},{value:"maintenance",label_ar:"Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©",label_en:"Under Maintenance"},{value:"construction",label_ar:"Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡",label_en:"Under Construction"},{value:"closed",label_ar:"Ù…ØºÙ„Ù‚ / Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©",label_en:"Closed / Inactive"}],Se=r.useCallback(async t=>{const p=[{id:t.city_id,collection:"ref_cities",nameKey:"city"},{id:t.district_id,collection:"ref_districts",nameKey:"district"},{id:t.sector_id,collection:"ref_sectors",nameKey:"sector"}],f={},se=p.map(async g=>{if(g.id)try{const h=await Ce(Ee(J,g.collection,g.id));if(h.exists()){const Z=h.data();f[`${g.nameKey}_name_ar`]=Z.name_ar,f[`${g.nameKey}_name_en`]=Z.name_en,f[`${g.nameKey}_code`]=Z.code,f[`${g.nameKey}_id`]=g.id}}catch(h){console.error(`Failed to fetch ${g.nameKey}:`,h)}});await Promise.all(se),n(f)},[]),ke=r.useCallback(async()=>{if(C&&!s){b(null);return}let t,p;if(s){const g=[["unit",s.unit_id],["floor",s.floor_id],["zone",s.zone_id],["building",s.building_id],["site",s.site_id]];for(const[h,Z]of g)if(Z){t=h,p=Z;break}!t&&u.parent_target&&s[`${u.parent_target}_id`]&&(t=u.parent_target,p=s[`${u.parent_target}_id`])}else c&&(E?(t="site",p=c):R?(t="zone",p=c):u.parent_target&&(t=u.parent_target,p=c));if(!t||!p){b(null);return}const f=G[t];if(!f)return;const se=Ee(J,f.collection,p);try{const g=await Ce(se);if(g.exists()){const h=g.data(),Z={...h,[`${t}_name_ar`]:h.name_ar,[`${t}_name_en`]:h.name_en,[`${t}_code`]:h.code,[`${t}_id`]:h.id};b(Z)}else b(null)}catch(g){console.error("Error fetching parent geo data:",g),b(null)}},[u.parent_target,c,s,E,R,C,i]);r.useEffect(()=>{if(a){L(s?.name_ar||""),A(s?.name_en||""),j(s?.code||""),U(s?.type_id||""),$(s?.reference_id||null),m(s?.status||"operational"),O(s?.floor_number!==void 0?s.floor_number:0);const t=s?.geo_data||{};k(t.center?.lat||""),ie(t.center?.lng||""),V(t.coordinates?.x||""),ae(t.coordinates?.y||""),je(t.coordinates?.z||""),xe(t.polygon?JSON.stringify(t.polygon,null,2):""),be(t.entrances?JSON.stringify(t.entrances,null,2):""),C&&s?(B(s.city_id||null),re(s.district_id||null),q(s.sector_id||null),Se(s)):C&&!s&&(B(null),re(null),q(null),n(null)),c&&i!=="site"&&!pe?ke():b(null),u.hasType&&Me()}},[a,s,i,c,ke,Se]);const Me=async()=>{let t="";if(i==="unit"?t="spatial_lookups/unit_types/values":i==="point"?t="spatial_lookups/point_types/values":i==="building"?t="spatial_lookups/building_types/values":i==="site"?t="spatial_lookups/site_types/values":i==="zone"&&(t="spatial_lookups/zone_types/values"),t){const p=await ee(M(Q(J,t),F("is_active","==",!0)));te(p.docs.map(f=>({id:f.id,...f.data()})))}},Je=t=>{L(t.name_ar),A(t.name_en),j(t.code||t.id),$(t.id)},Pe=async t=>{t.preventDefault();const p={};if(u.geoInputType==="external_global"&&w!==""&&D!==""&&(p.center={lat:Number(w),lng:Number(D)}),(u.geoInputType==="internal_floor"||u.geoInputType==="internal_unit")&&X!==""&&_!==""&&(p.coordinates={x:Number(X),y:Number(_)},fe!==""&&(p.coordinates.z=Number(fe))),de)try{const g=JSON.parse(de);Array.isArray(g)&&g.length>0&&(p.polygon=g.map(h=>Array.isArray(h)&&h.length>=2?{lat:h[0],lng:h[1]}:h))}catch{console.error("Ignored invalid polygon JSON")}if(ue)try{const g=JSON.parse(ue);Array.isArray(g)&&g.length>0&&(p.entrances=g.map(h=>h.coordinates&&Array.isArray(h.coordinates)?{...h,coordinates:{lat:h.coordinates[0],lng:h.coordinates[1]}}:h))}catch{console.error("Ignored invalid entrances JSON")}let f={name_ar:N,name_en:P,code:T,type_id:K||null,reference_id:z,status:H};Object.keys(p).length>0&&(f.geo_data=p),C?(f.country_id=Nt,f.emirate_id=jt,f.region_id=Re,f.sector_id=ce,f.district_id=le,f.city_id=Y,ne?Object.assign(f,ne):s&&["city","district","sector"].forEach(g=>{s[`${g}_name_ar`]&&(f[`${g}_name_ar`]=s[`${g}_name_ar`]),s[`${g}_name_en`]&&(f[`${g}_name_en`]=s[`${g}_name_en`]),s[`${g}_code`]&&(f[`${g}_code`]=s[`${g}_code`])})):E&&c?f.site_id=c:R&&c?f.zone_id=c:u.parent_target&&c&&(f[`${u.parent_target}_id`]=c),Fe&&(f.floor_number=Number(y));const se=we(f);console.log("ðŸš€ Submitting Payload:",se),await d(se)},he=Y||s?.city_id,ye=le||s?.district_id,He=ce||s?.sector_id,I={...s,...ne||{}};let _e=null;return u.parent_target&&!C&&i!=="country"&&(v?_e={field:`${u.parent_target}_id`,value:v}:c&&(_e={field:`${u.parent_target}_id`,value:c})),e.jsx(Ze,{children:a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs(me.div,{variants:Ge,initial:"initial",animate:"animate",exit:"exit",className:"w-full max-w-lg bg-[#0d1b2a] border border-gray-700 rounded-xl shadow-2xl overflow-visible max-h-[90vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800/50 sticky top-0 z-20 backdrop-blur-md",children:[e.jsxs("h3",{className:"text-lg font-bold text-white",children:[s?l==="ar"?"ØªØ¹Ø¯ÙŠÙ„":"Edit":l==="ar"?"Ø¥Ø¶Ø§ÙØ©":"Add"," ",l==="ar"?u.label_ar:u.label_en]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-white",children:e.jsx(Ke,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:Pe,className:"p-4 space-y-6",children:[C&&e.jsxs("div",{className:"space-y-4 bg-gray-800/30 p-4 rounded-lg border border-gray-700",children:[e.jsx("h4",{className:"text-[#FFD700] text-sm font-bold mb-2",children:l==="ar"?"1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ":"1. Select Location"}),e.jsx(ge,{collectionName:"ref_cities",parentFilter:{field:"region_id",value:Re},label:l==="ar"?"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©":"City",placeholder:l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...":"Select City...",onSelect:t=>{B(t.id),re(null),q(null),n(p=>({...p,city_name_ar:t.name_ar,city_name_en:t.name_en,city_code:t.code,city_id:t.id}))},initialValue:I.city_id?{name_ar:I.city_name_ar,name_en:I.city_name_en,code:I.city_code}:void 0},`city-${s?.id||"new"}`),he&&e.jsx(ge,{collectionName:"ref_districts",parentFilter:{field:"city_id",value:he},label:l==="ar"?"Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ø­ÙŠ":"District",placeholder:l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„Ø­ÙŠ...":"Select District...",onSelect:t=>{re(t.id),q(null),n(p=>({...p,district_name_ar:t.name_ar,district_name_en:t.name_en,district_code:t.code,district_id:t.id}))},initialValue:I.district_id?{name_ar:I.district_name_ar,name_en:I.district_name_en,code:I.district_code}:void 0},`district-${he}`),ye&&e.jsx(ge,{collectionName:"ref_sectors",parentFilter:{field:"district_id",value:ye},label:l==="ar"?"Ø§Ù„Ù‚Ø·Ø§Ø¹ / Ø§Ù„Ø­ÙˆØ¶":"Sector",placeholder:l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹...":"Select Sector...",onSelect:t=>{q(t.id),n(p=>({...p,sector_name_ar:t.name_ar,sector_name_en:t.name_en,sector_code:t.code,sector_id:t.id}))},initialValue:I.sector_id?{name_ar:I.sector_name_ar,name_en:I.sector_name_en,code:I.sector_code}:void 0},`sector-${ye}`)]}),x&&!C&&e.jsx(Ft,{itemData:x,language:l}),pe&&!C&&!s&&e.jsx("div",{className:"mb-4",children:e.jsx(ge,{collectionName:u.referenceCollection,parentFilter:_e,label:l==="ar"?`Ø§Ø®ØªØ± ${u.label_ar}`:`Select ${u.label_en}`,placeholder:l==="ar"?"Ø§Ø¨Ø­Ø« Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±...":"Search to select...",onSelect:Je,initialValue:s?{name_ar:s.name_ar,name_en:s.name_en,code:s.code}:void 0})}),(!pe||C)&&e.jsxs("div",{className:C&&!s?"pt-2 border-t border-gray-700":"",children:[(C&&!s||ze)&&e.jsx("h4",{className:"text-[#FFD700] text-sm font-bold mb-4",children:l==="ar"?"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ±":"Item Details"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":"Name (Arabic)"}),e.jsx("input",{type:"text",value:N,onChange:t=>L(t.target.value),required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©":"Name (English)"}),e.jsx("input",{type:"text",value:P,onChange:t=>A(t.target.value),required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø±Ù…Ø² Ø§Ù„ØªØ¹Ø±ÙŠÙ (Code)":"Code"}),e.jsx("input",{type:"text",value:T,onChange:t=>j(t.target.value),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none"})]}),Fe&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:[l==="ar"?"Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ø¨Ù‚ (Ù„Ù„ÙÙ‡Ø±Ø³Ø©)":"Floor Number (Index)",e.jsx("span",{className:"text-xs text-gray-500 mx-2",children:"(0=Ø£Ø±Ø¶ÙŠ, -1=Ø³Ø±Ø¯Ø§Ø¨, 1=Ø£ÙˆÙ„...)"})]}),e.jsx("input",{type:"number",value:y,onChange:t=>O(Number(t.target.value)),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none"})]})]}),u.hasType&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ù†ÙˆØ¹":"Type"}),e.jsxs("select",{value:K,onChange:t=>U(t.target.value),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",children:[e.jsx("option",{value:"",children:l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...":"Select Type..."}),W.map(t=>e.jsx("option",{value:t.id,children:l==="ar"?t.name_ar:t.name_en},t.id))]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©":"Status"}),e.jsx("select",{value:H,onChange:t=>m(t.target.value),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",children:De.map(t=>e.jsx("option",{value:t.value,children:l==="ar"?t.label_ar:t.label_en},t.value))})]}),u.geoInputType&&u.geoInputType!=="none"&&e.jsxs("div",{className:"space-y-4 bg-gray-800/30 p-4 rounded-lg border border-gray-700",children:[e.jsx("h4",{className:"text-[#FFD700] text-sm font-bold mb-2",children:l==="ar"?"3. Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø©":"3. Geo & Navigation Coordinates"}),u.geoInputType==="external_global"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-400 text-xs",children:l==="ar"?"Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø±ÙƒØ² (Ø®Ø· Ø§Ù„Ø·ÙˆÙ„/Ø§Ù„Ø¹Ø±Ø¶ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©).":"Center Coordinates (Lat/Lng for external map positioning)."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude)":"Latitude (Lat)"}),e.jsx("input",{type:"number",step:"any",value:w,onChange:t=>k(Number(t.target.value)),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"0.000000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude)":"Longitude (Lng)"}),e.jsx("input",{type:"number",step:"any",value:D,onChange:t=>ie(Number(t.target.value)),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"0.000000"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ù…Ø¶Ù„Ø¹ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (Polygon - Lat/Lng Array JSON)":"External Boundary Polygon (JSON)"}),e.jsx("textarea",{value:de,onChange:t=>xe(t.target.value),rows:6,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-xs focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"[ [lat1, lng1], [lat2, lng2], ... ]"}),e.jsx("p",{className:"text-red-400 text-xs mt-1",children:l==="ar"?"Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON ØµØ­ÙŠØ­.":"Note: Value must be in valid JSON format."})]}),(i==="site"||i==="building")&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ù…Ø¯Ø§Ø®Ù„/Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Entrances - JSON)":"Site/Building Entrances (JSON)"}),e.jsx("textarea",{value:ue,onChange:t=>be(t.target.value),rows:6,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-xs focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:'[{name:"Main", type:"main", coordinates:{lat:0, lng:0}}, ...]'}),e.jsx("p",{className:"text-red-400 text-xs mt-1",children:l==="ar"?"Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON ØµØ­ÙŠØ­.":"Note: Value must be in valid JSON format."})]})]}),(u.geoInputType==="internal_floor"||u.geoInputType==="internal_unit")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-400 text-xs",children:l==="ar"?"Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (X/Y/Z Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø¹Ù„Ù‰ Ù…Ø®Ø·Ø· Ø§Ù„Ø·Ø§Ø¨Ù‚).":"Internal Coordinates (X/Y/Z for position on the floor plan)."}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ù…Ø­ÙˆØ± X":"X-Axis"}),e.jsx("input",{type:"number",step:"any",value:X,onChange:t=>V(Number(t.target.value)),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ù…Ø­ÙˆØ± Y":"Y-Axis"}),e.jsx("input",{type:"number",step:"any",value:_,onChange:t=>ae(Number(t.target.value)),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"0"})]}),(u.geoInputType==="internal_floor"||i==="point")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ù…Ø­ÙˆØ± Z (Ø§Ù„Ø§Ø±ØªÙØ§Ø¹)":"Z-Axis (Height)"}),e.jsx("input",{type:"number",step:"any",value:fe,onChange:t=>je(Number(t.target.value)),className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"0"})]})]}),u.geoInputType==="internal_floor"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ø§Ù„Ù…Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (Ø³Ù„Ø§Ù„Ù…/Ù…ØµØ§Ø¹Ø¯ - JSON)":"Internal Entrances (Stairs/Elevators - JSON)"}),e.jsx("textarea",{value:ue,onChange:t=>be(t.target.value),rows:6,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-xs focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:'[{name:"Elevator A", type:"main", coordinates:{x:100, y:50, z:0}}, ...]'}),e.jsx("p",{className:"text-red-400 text-xs mt-1",children:l==="ar"?"Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON ØµØ­ÙŠØ­.":"Note: Value must be in valid JSON format."})]}),(i==="zone"||i==="unit")&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:l==="ar"?"Ù…Ø¶Ù„Ø¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„ÙˆØ­Ø¯Ø© (X/Y Array JSON)":"Zone/Unit Boundary Polygon (JSON)"}),e.jsx("textarea",{value:de,onChange:t=>xe(t.target.value),rows:6,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-xs focus:border-[#FFD700] focus:ring-1 focus:ring-[#FFD700] outline-none",placeholder:"[ [x1, y1], [x2, y2], ... ]"}),e.jsx("p",{className:"text-red-400 text-xs mt-1",children:l==="ar"?"Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON ØµØ­ÙŠØ­.":"Note: Value must be in valid JSON format."})]})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-700 transition-colors",children:l==="ar"?"Ø¥Ù„ØºØ§Ø¡":"Cancel"}),e.jsx("button",{type:"submit",disabled:S||C&&!He&&!s,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-[#FFD700] text-black font-bold hover:bg-[#e6c200] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:S?e.jsx("span",{className:"w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-5 h-5"})," ",l==="ar"?"Ø­ÙØ¸":"Save"]})})]})]})]})})})}function It(){const{language:a}=Ne(),{showDialog:o}=Ue(),{showActionLoading:d,hideActionLoading:i}=We(),[c,v]=r.useState("site"),[s,S]=r.useState(null),[E,R]=r.useState([]),[l,u]=r.useState(!1),[N,L]=r.useState([]),[P,A]=r.useState(!1),[T,j]=r.useState(void 0),[K,U]=r.useState(!1),[z,$]=r.useState(!1),[H,m]=r.useState(!1),y=G[c],O=async()=>{u(!0);try{const n=Q(J,y.collection);let x;if(c==="building"&&s){const b=M(Q(J,"buildings"),F("site_id","==",s),F("is_active","==",!0)),k=(await ee(b)).docs.map(_=>({id:_.id,..._.data(),_type:"building"})),D=M(Q(J,"zones"),F("site_id","==",s),F("is_active","==",!0)),X=(await ee(D)).docs.filter(_=>!_.data().building_id).map(_=>({id:_.id,..._.data(),_type:"zone",is_outdoor:!0})),V=[...k,...X];V.sort((_,ae)=>(_.name_ar||"").localeCompare(ae.name_ar||"")),R(V)}else if(c==="zone"&&s){const b=M(Q(J,"zones"),F("building_id","==",s),F("is_active","==",!0)),k=(await ee(b)).docs.map(_=>({id:_.id,..._.data(),_type:"zone"})),D=M(Q(J,"floors"),F("zone_id","==",s),F("is_active","==",!0)),X=(await ee(D)).docs.map(_=>({id:_.id,..._.data(),_type:"floor"})),V=[...k,...X];V.sort((_,ae)=>(_.name_ar||"").localeCompare(ae.name_ar||"")),R(V)}else{if(y.parent_target&&s){const k=`${y.parent_target}_id`;x=M(n,F(k,"==",s),F("is_active","==",!0))}else x=M(n,F("is_active","==",!0));const w=(await ee(x)).docs.map(k=>({id:k.id,...k.data(),_type:c}));w.sort((k,D)=>(k.code||"").localeCompare(D.code||"")),R(w)}}catch(n){console.error("Error fetching items:",n)}finally{u(!1)}};r.useEffect(()=>{O()},[c,s]);const W=n=>{if(n._type==="zone"&&n.is_outdoor){L(w=>[...w,{target:c,id:n.id,name:a==="ar"?n.name_ar:n.name_en}]),S(n.id),v("unit");return}if(n.is_outdoor)return;const x=n._type||c,b=G[x];b.child_target&&(L(w=>[...w,{target:x,id:n.id,name:a==="ar"?n.name_ar:n.name_en}]),S(n.id),v(b.child_target))},te=n=>{if(n===-1){L([]),S(null),v("site");return}const x=N[n],b=G[x.target];b.child_target&&(L(N.slice(0,n+1)),S(x.id),v(b.child_target))},Y=()=>{N.length!==0&&te(N.length-2)},B=async n=>{U(!0);try{const x=Le(Ae,"manageSpatialStructure"),b={...n};let w=c;z?(w="zone",b.site_id=s):H?(w="unit",b.zone_id=s):w=c,T&&(delete b.site_id,delete b.zone_id),await x({target:w,action:T?"update":"create",docId:T?.id,data:b}),A(!1),$(!1),m(!1),O(),j(void 0)}catch(x){o({variant:"alert",title:"Ø®Ø·Ø£",message:x.message})}finally{U(!1)}},le=(n,x)=>{x.stopPropagation();const b=n._type||c;o({variant:"confirm",title:a==="ar"?"Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±":"Delete Item",message:a==="ar"?"Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ":"This will delete the item and all contents. Are you sure?",onConfirm:async()=>{d(a==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...":"Deleting...");try{await Le(Ae,"manageSpatialStructure")({target:b,action:"delete",docId:n.id}),await O()}catch(w){o({variant:"alert",title:"Ø®Ø·Ø£",message:w.message})}finally{i()}}})},re=()=>{j(void 0),$(!1),m(!1),A(!0)},ce=()=>{j(void 0),$(!0),m(!1),A(!0)},q=()=>{j(void 0),$(!1),m(!0),A(!0)},ne=n=>{j(n),$(n._type==="zone"&&!!n.site_id&&!n.building_id),m(n._type==="unit"&&!!n.zone_id&&!n.floor_id),A(!0)};return e.jsxs("div",{className:"flex flex-col h-full space-y-4 p-4 sm:p-6 dir-rtl",children:[e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-md border border-gray-700 rounded-xl p-4 shadow-lg sticky top-0 z-10",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(y.icon,{className:"w-6 h-6 text-[#FFD700]"}),a==="ar"?y.label_ar:y.label_en]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c==="building"&&s&&e.jsxs("button",{onClick:ce,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors text-sm sm:text-base shadow-md",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:a==="ar"?"Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©":"Add Outdoor Zone"})]}),c==="zone"&&s&&E.some(n=>n.is_outdoor)&&e.jsxs("button",{onClick:q,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 transition-colors text-sm sm:text-base shadow-md",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:a==="ar"?"Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø®Ø§Ø±Ø¬ÙŠØ©":"Add Outdoor Unit"})]}),e.jsxs("button",{onClick:re,className:"flex items-center gap-2 bg-[#FFD700] text-black px-4 py-2 rounded-lg font-bold hover:bg-[#e6c200] transition-colors text-sm sm:text-base shadow-md shadow-yellow-900/20",children:[e.jsx(tt,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:a==="ar"?`Ø¥Ø¶Ø§ÙØ© ${y.label_ar}`:`Add ${y.label_en}`})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-600",children:[N.length>0&&e.jsx("button",{onClick:Y,className:"p-1.5 bg-gray-700 rounded-full text-gray-300 hover:text-white hover:bg-gray-600 transition-colors flex-shrink-0",children:a==="ar"?e.jsx($e,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4 transform scale-x-[-1]"})}),e.jsx("button",{onClick:()=>te(-1),className:`whitespace-nowrap px-3 py-1 rounded-full text-sm transition-colors ${N.length===0?"bg-[#FFD700]/20 text-[#FFD700] border border-[#FFD700]/50":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:a==="ar"?"Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹":"Sites"}),N.map((n,x)=>e.jsxs(Ye.Fragment,{children:[a==="ar"?e.jsx(at,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}):e.jsx(st,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),e.jsx("button",{onClick:()=>te(x),className:`whitespace-nowrap px-3 py-1 rounded-full text-sm transition-colors flex items-center gap-1 ${x===N.length-1?"bg-blue-500/20 text-blue-300 border border-blue-500/50":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:n.name})]},n.id))]})]})}),e.jsx(me.div,{variants:qe,initial:"initial",animate:"animate",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:l?[...Array(4)].map((n,x)=>e.jsx("div",{className:"h-32 bg-gray-800/30 rounded-xl animate-pulse border border-gray-700"},x)):E.length===0?e.jsxs(me.div,{variants:Xe,className:"col-span-full flex flex-col items-center justify-center py-20 text-gray-500",children:[e.jsx(ut,{className:"w-16 h-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:a==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§":"No items found here"})]}):E.map(n=>e.jsxs(me.div,{variants:Qe,whileHover:"hover",whileTap:"tap",onClick:()=>W(n),className:`group relative backdrop-blur-sm border rounded-xl p-4 cursor-pointer transition-all duration-300 hover:shadow-lg ${n.is_outdoor?"bg-blue-900/20 border-blue-700/50 hover:border-blue-500":"bg-gray-800/40 border-gray-700 hover:border-[#FFD700]/50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${n.is_outdoor?"bg-blue-800/50 text-blue-300":"bg-gray-700/50 text-gray-400 group-hover:bg-[#FFD700]/20 group-hover:text-[#FFD700]"}`,children:n.is_outdoor&&n._type==="zone"?e.jsx(ve,{className:"w-6 h-6"}):e.jsx(y.icon,{className:"w-6 h-6"})}),n.code&&e.jsx("span",{className:"text-xs font-mono bg-black/30 text-gray-400 px-2 py-1 rounded border border-gray-700",children:n.code})]}),e.jsx("h3",{className:"text-white font-bold text-lg truncate mb-1",children:a==="ar"?n.name_ar:n.name_en}),e.jsx("p",{className:"text-gray-500 text-xs truncate",children:a==="ar"?n.name_en:n.name_ar}),n.is_outdoor&&n._type==="zone"&&e.jsx("span",{className:"inline-block mt-2 text-[10px] bg-blue-600/30 text-blue-200 px-2 py-0.5 rounded-full border border-blue-500/30",children:a==="ar"?"Ù…Ù†Ø·Ù‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©":"Outdoor Zone"}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),ne(n)},className:"p-1.5 bg-gray-700 hover:bg-blue-600 text-gray-300 hover:text-white rounded-lg transition-colors shadow-sm",children:e.jsx(et,{className:"w-4 h-4"})}),e.jsx("button",{onClick:x=>le(n,x),className:"p-1.5 bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white rounded-lg transition-colors shadow-sm",children:e.jsx(rt,{className:"w-4 h-4"})})]})]},n.id))}),e.jsx(St,{isOpen:P,onClose:()=>A(!1),onSubmit:B,target:z?"zone":H?"unit":c,parentId:s,initialData:T,isSubmitting:K,isAddingOutdoorZone:z,isAddingOutdoorUnit:H})]})}export{It as default};
