import{u as ae,a as te,c as re,b as ne,d as ie,e as oe,r,T as P,k as e,A as z,m as l,l as le,s as ce,x as B,H as de,z as U,F as V,as as me,J as ue,v as ge,aU as pe,K as xe,aI as H,n as k,L as he,M as O,N as M,q as fe,h as L,i as T}from"./index-AlbxRJrk.js";import{F as be,a as ve}from"./ArrowUpIcon-BdLtLEOm.js";import{F as ye}from"./ChevronDownIcon-BtYLWBft.js";function N({Icon:i,label:c,value:u,colorClass:b="text-gray-300"}){return e.jsxs("div",{className:"flex flex-col text-start",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-400 font-semibold mb-1",children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:c})]}),e.jsx("span",{className:`font-bold text-base break-words ${b}`,children:u})]})}function we({options:i,selected:c,onChange:u,title:b,translations:x}){const[v,w]=r.useState(!1),h=r.useRef(null),R=n=>{const j=c.includes(n)?c.filter(_=>_!==n):[...c,n];u(j)};r.useEffect(()=>{function n(j){h.current&&!h.current.contains(j.target)&&w(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[h]);const F=c.length===0?x.all:`${c.length} ${x.selected}`;return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onClick:()=>w(!v),className:"flex items-center gap-2 bg-gray-700 p-2 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700]",children:[e.jsxs("span",{children:[b,": ",F]}),e.jsx(ye,{className:`w-4 h-4 transition-transform ${v?"rotate-180":""}`})]}),e.jsx(z,{children:v&&e.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute z-10 mt-2 w-56 bg-gray-800 border border-gray-600 rounded-md shadow-lg p-2 top-full rtl:right-0",children:i.map(n=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-700 rounded-md cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded bg-gray-600 border-gray-500 text-[#FFD700] focus:ring-[#FFD700]",checked:c.includes(n.value),onChange:()=>R(n.value)}),e.jsx("span",{children:n.label})]},n.value))})})]})}function _e(){const{language:i}=ae(),{hasPermission:c,isLoading:u}=te(),{setPageLoading:b}=re(),{showDialog:x}=ne(),{showActionLoading:v,hideActionLoading:w}=ie(),h=oe(),[R,F]=r.useState([]),[n,j]=r.useState(!1),[_,$]=r.useState(null),[A,J]=r.useState(""),[S,G]=r.useState([]),[y,q]=r.useState({key:"created_at",direction:"descending"}),E=r.useMemo(()=>({ar:{searchPlaceholder:"ابحث باسم المستخدم أو البريد الإلكتروني...",noRecords:"لم يتم العثور على طلبات إنشاء مستخدمين مطابقة.",errorLoading:"حدث خطأ أثناء تحميل البيانات.",userName:"اسم المستخدم",email:"البريد الإلكتروني",jobName:"المسمى الوظيفي",createdDate:"تاريخ الطلب",status:"الحالة",viewDetails:"عرض التفاصيل",edit:"تعديل الطلب",editingNotAllowedTitle:"غير مسموح بالتعديل",editingNotAllowedMessage:"يمكن تعديل الطلب فقط عندما تكون حالته 'بحاجة لمراجعة'.",permissionMissingTitle:"صلاحية غير كافية",permissionMissingEditMessage:"لا تملك الصلاحية اللازمة لتعديل هذا الطلب (sss:15).",filterByStatus:"فلترة حسب الحالة",all:"الكل",needsRevision:"بحاجة لمراجعة",awaitingApproval:"بانتظار الاعتماد",approved:"معتمد",Rejected:"مرفوض",sortBy:"فرز حسب",sortDirection:"اتجاه الفرز",selected:"محدد",companyName:"الشركة",preparingPage:"جاري تجهيز الصفحة..."},en:{searchPlaceholder:"Search by user name or email...",noRecords:"No matching user requests found.",errorLoading:"An error occurred while loading data.",userName:"User Name",email:"Email",jobName:"Job Title",createdDate:"Request Date",status:"Status",viewDetails:"View Details",edit:"Edit Request",editingNotAllowedTitle:"Editing Not Allowed",editingNotAllowedMessage:"A request can only be edited when its status is 'Needs Revision'.",permissionMissingTitle:"Insufficient Permission",permissionMissingEditMessage:"You do not have the required permission to edit this request (sss:15).",filterByStatus:"Filter by Status",all:"All",needsRevision:"Needs Revision",awaitingApproval:"Awaiting Approval",approved:"Approved",Rejected:"Rejected",sortBy:"Sort by",sortDirection:"Sort Direction",selected:"selected",companyName:"Company",preparingPage:"Preparing page..."}}),[i]),s=i==="ar"?E.ar:E.en,K=c("sss:15");r.useEffect(()=>{b(u||!n)},[u,n,b]),r.useEffect(()=>{if(u)return;(async()=>{try{const[t,d,o]=await Promise.all([M(fe(L(T,"user_onboarding_requests"))),M(L(T,"companies")),M(L(T,"jobs"))]),g=new Map(d.docs.map(p=>[p.id,p.data()])),f=new Map(o.docs.map(p=>[p.id,p.data()])),X=t.docs.map(p=>{const m=p.data(),D=g.get(m.company_id),C=f.get(String(m.job_id)),Z=i==="ar"?m.name_ar:m.name_en||m.name_ar,ee=i==="ar"?D?.name_ar:D?.name_en||D?.name_ar||"Unknown",se=i==="ar"?C?.name_ar:C?.name_en||C?.name_ar||"Unknown";return{id:p.id,sequence_number:m.sequence_number,user_name:Z,email:m.email,company_name:ee,job_name:se,status:m.status,created_at:m.created_at}});F(X),$(null)}catch(t){console.error("Error fetching user request history:",t),$(s.errorLoading)}finally{j(!0)}})()},[u,i,s.errorLoading]),r.useCallback((a,t,d)=>{if(!t){x({variant:"alert",title:s.permissionMissingTitle,message:d});return}v(s.preparingPage);const o=window.open(a,"_blank");setTimeout(()=>{w(),o||x({variant:"alert",title:s.errorLoading,message:"Please allow pop-ups for this site."})},1500)},[x,v,w,s]),r.useCallback(a=>{h(a)},[h]);const Y=r.useCallback(a=>{switch(a){case"Needs Revision":return{text:s.needsRevision,color:"text-orange-400"};case"Awaiting Approval":return{text:s.awaitingApproval,color:"text-yellow-400"};case"Approved":return{text:s.approved,color:"text-green-400"};case"Rejected":return{text:s.Rejected,color:"text-red-400"};default:return{text:a,color:"text-gray-400"}}},[s]),I=r.useMemo(()=>{let a=[...R];if(A){const t=A.toLowerCase();a=a.filter(d=>d.user_name.toLowerCase().includes(t)||d.email.toLowerCase().includes(t))}return S.length>0&&(a=a.filter(t=>S.includes(t.status))),a.sort((t,d)=>{const o=t[y.key],g=d[y.key];let f=0;return o instanceof P&&g instanceof P?f=o.toMillis()-g.toMillis():typeof o=="string"&&typeof g=="string"?f=o.localeCompare(g):typeof o=="number"&&typeof g=="number"&&(f=o-g),y.direction==="ascending"?f:-f}),a},[R,A,S,y]),Q=()=>{q(a=>({...a,direction:a.direction==="ascending"?"descending":"ascending"}))},W=[{value:"Approved",label:s.approved},{value:"Rejected",label:s.Rejected},{value:"Needs Revision",label:s.needsRevision},{value:"Awaiting Approval",label:s.awaitingApproval}];return e.jsx(z,{mode:"wait",children:e.jsx(l.div,{custom:i,variants:le,initial:"initial",animate:"animate",exit:"exit",children:n?e.jsxs(l.div,{variants:ce,initial:"initial",animate:"animate",className:"space-y-6",children:[e.jsxs(l.div,{variants:B,className:"bg-gray-800/50 rounded-xl shadow-2xl p-4 border border-gray-700 space-y-4",children:[e.jsx("div",{className:"flex justify-end rtl:justify-start",children:e.jsxs("div",{className:"w-full sm:w-auto relative",children:[e.jsx(de,{className:"w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2 rtl:left-auto rtl:right-3"}),e.jsx("input",{type:"text",placeholder:s.searchPlaceholder,value:A,onChange:a=>J(a.target.value),className:"w-full sm:w-72 bg-gray-700 py-2 pl-10 pr-3 rtl:pr-10 rtl:pl-3 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700] transition-colors"})]})}),e.jsx("hr",{className:"border-gray-700"}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-center gap-4",children:[e.jsx(we,{options:W,selected:S,onChange:G,title:s.filterByStatus,translations:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-300",children:[s.sortBy,":"]}),e.jsxs("select",{value:y.key,onChange:a=>q(t=>({...t,key:a.target.value})),className:"bg-gray-700 p-2 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FFD700]",children:[e.jsx("option",{value:"created_at",children:s.createdDate}),e.jsx("option",{value:"user_name",children:s.userName}),e.jsx("option",{value:"company_name",children:s.companyName}),e.jsx("option",{value:"job_name",children:s.jobName}),e.jsx("option",{value:"email",children:s.email})]}),e.jsx("button",{onClick:Q,title:s.sortDirection,className:"p-2 bg-gray-700 rounded-md border border-gray-600 hover:bg-gray-600 transition-colors",children:y.direction==="ascending"?e.jsx(be,{className:"w-5 h-5"}):e.jsx(ve,{className:"w-5 h-5"})})]})]})]}),e.jsx("div",{className:"space-y-4",children:_?e.jsxs(l.div,{variants:U,className:"bg-red-900/50 border border-red-700 rounded-lg p-6 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-red-400"}),e.jsx("p",{className:"mt-4 text-lg font-semibold text-red-300",children:_})]}):I.length===0?e.jsxs(l.div,{variants:U,className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-yellow-400"}),e.jsx("p",{className:"mt-4 text-lg font-semibold text-yellow-300",children:s.noRecords})]}):I.map(a=>{const{text:t,color:d}=Y(a.status),o={dateStyle:"short",timeStyle:"short",numberingSystem:"latn"};return e.jsx(l.div,{layout:!0,variants:B,className:"bg-gradient-to-br from-gray-900/80 to-gray-800/80 rounded-lg p-4 sm:p-5 shadow-lg border border-gray-700 hover:border-[#FFD700]/30 transition-all duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-grow grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-x-6 gap-y-4 w-full",children:[e.jsx(N,{Icon:me,label:s.userName,value:a.user_name,colorClass:"text-white"}),e.jsx(N,{Icon:ue,label:s.companyName,value:a.company_name,colorClass:"text-white"}),e.jsx(N,{Icon:ge,label:s.jobName,value:a.job_name}),e.jsx(N,{Icon:pe,label:s.email,value:a.email}),e.jsx(N,{Icon:xe,label:s.createdDate,value:a.created_at?.toDate().toLocaleString(i==="ar"?"ar-EG":"en-US",o)||"N/A"})]}),e.jsx("div",{className:"w-full sm:w-px sm:h-12 bg-gray-700 self-stretch"}),e.jsxs("div",{className:"flex flex-row sm:flex-col items-center justify-between sm:justify-center gap-3 w-full sm:w-auto sm:min-w-[150px]",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-gray-400 font-semibold mb-1",children:s.status}),e.jsx("span",{className:`font-bold text-base text-center ${d}`,children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{to:`/system/users/details/${a.sequence_number}`,className:"block",children:e.jsx(l.div,{variants:k,whileHover:"hover",whileTap:"tap",title:s.viewDetails,className:"p-2 text-blue-400 hover:text-blue-300 transition-colors cursor-pointer",children:e.jsx(he,{className:"w-5 h-5"})})}),a.status==="Needs Revision"&&(K?e.jsx(H,{to:`/system/users/edit/${a.sequence_number}`,className:"block",children:e.jsx(l.div,{variants:k,whileHover:"hover",whileTap:"tap",title:s.edit,className:"p-2 text-yellow-500 hover:text-yellow-400 transition-colors cursor-pointer",children:e.jsx(O,{className:"w-5 h-5"})})}):e.jsx(l.button,{variants:k,whileHover:"hover",whileTap:"tap",onClick:()=>x({variant:"alert",title:s.permissionMissingTitle,message:s.permissionMissingEditMessage}),title:s.permissionMissingTitle,className:"p-2 text-gray-600 cursor-not-allowed transition-colors",children:e.jsx(O,{className:"w-5 h-5"})}))]})]})]})},a.id)})})]}):e.jsx("div",{className:"space-y-4 pt-20",children:Array.from({length:5}).map((a,t)=>e.jsx(l.div,{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700 h-28 animate-pulse"},t))})},i)})}export{_e as default};
