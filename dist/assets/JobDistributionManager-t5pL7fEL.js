import{r as i,u as q,b as B,d as G,q as H,o as T,h as j,am as z,an as I,k as e,v as R,A as U,m as k,as as W,N as _,J as A}from"./index-AlbxRJrk.js";import{u as K}from"./useAccessManager-rkPHho6Y.js";import{F as Q}from"./MapPinIcon-Dkd4wD6-.js";import{F as L,a as X}from"./TrashIcon-DqVoRP7K.js";import{F as Y}from"./FunnelIcon-C_Cz-zVd.js";function Z({title:r,titleId:a,...d},c){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},d),r?i.createElement("title",{id:a},r):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"}))}const D=i.forwardRef(Z),v=z(),ee={ar:{title:"إدارة توزيع الوظائف",subtitle:"تحديد مواقع تواجد الوظائف (الشركات والأقسام).",addRule:"توزيع وظيفة جديدة",searchPlaceholder:"ابحث عن وظيفة أو شركة...",noRules:"لا توجد قواعد توزيع مضافة.",autoGenerated:"تلقائي (من الموظفين)",manual:"يدوي (إعداد مسبق)",job:"الوظيفة",location:"الموقع التنظيمي",actions:"إجراءات",confirmDelete:"هل أنت متأكد من حذف قاعدة التوزيع هذه؟",deleteSuccess:"تم حذف التوزيع بنجاح.",addSuccess:"تم إضافة التوزيع بنجاح.",filterCompany:"تصفية حسب الشركة",allCompanies:"كل الشركات",selectJob:"اختر الوظيفة",selectCompany:"اختر الشركة",selectSection:"القسم (اختياري)",save:"حفظ التوزيع",cancel:"إلغاء",saving:"جاري الحفظ...",deleting:"جاري الحذف..."},en:{title:"Job Distribution Manager",subtitle:"Define where jobs exist (Companies and Sections).",addRule:"Distribute New Job",searchPlaceholder:"Search job or company...",noRules:"No distribution rules found.",autoGenerated:"Auto (From Users)",manual:"Manual (Preset)",job:"Job Title",location:"Location",actions:"Actions",confirmDelete:"Are you sure you want to delete this rule?",deleteSuccess:"Rule deleted successfully.",addSuccess:"Rule added successfully.",filterCompany:"Filter by Company",allCompanies:"All Companies",selectJob:"Select Job",selectCompany:"Select Company",selectSection:"Section (Optional)",save:"Save Rule",cancel:"Cancel",saving:"Saving...",deleting:"Deleting..."}},se=({rule:r,lookups:a,language:d})=>{const c=d==="ar",l=(b,m)=>{if(!m)return null;const p=b.find(g=>String(g.id)===String(m));return p?c?p.name_ar:p.name_en:m},f=l(a.companies,r.company_id),n=l(a.sections,r.section_id||null);return e.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-xs text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-300 bg-gray-700/50 px-2 py-0.5 rounded border border-gray-600/50",children:[e.jsx(A,{className:"w-3 h-3"})," ",f]}),n&&e.jsx("span",{className:"text-gray-600",children:"/"}),n&&e.jsx("span",{className:"text-[#FFD700] bg-[#FFD700]/10 px-1.5 py-0.5 rounded border border-[#FFD700]/20",children:n})]})},ae=({isOpen:r,onClose:a,onSave:d,lookups:c,t:l,language:f})=>{const[n,b]=i.useState({job_id:"",company_id:"",sector_id:null,department_id:null,section_id:null}),m=f==="ar",p=c.sections,g=()=>{!n.job_id||!n.company_id||d(n)};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsxs(k.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-gray-800 border border-gray-700 rounded-xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-400"})," ",l.addRule]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 mb-1 block",children:[l.selectJob," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:n.job_id,onChange:t=>b({...n,job_id:t.target.value}),className:"w-full bg-gray-900 border border-gray-600 rounded-lg p-2.5 pl-10 text-sm text-white focus:border-blue-500 appearance-none",children:[e.jsx("option",{value:"",children:"---"}),c.jobs.map(t=>e.jsx("option",{value:t.id,children:m?t.name_ar:t.name_en},t.id))]}),e.jsx(R,{className:"w-5 h-5 text-gray-500 absolute left-3 top-2.5 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 mb-1 block",children:[l.selectCompany," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:n.company_id,onChange:t=>b({...n,company_id:t.target.value}),className:"w-full bg-gray-900 border border-gray-600 rounded-lg p-2.5 pl-10 text-sm text-white focus:border-blue-500 appearance-none",children:[e.jsx("option",{value:"",children:"---"}),c.companies.map(t=>e.jsx("option",{value:t.id,children:m?t.name_ar:t.name_en},t.id))]}),e.jsx(A,{className:"w-5 h-5 text-gray-500 absolute left-3 top-2.5 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:l.selectSection}),e.jsxs("select",{value:n.section_id||"",onChange:t=>b({...n,section_id:t.target.value||null}),className:"w-full bg-gray-900 border border-gray-600 rounded-lg p-2.5 text-sm text-white focus:border-blue-500",children:[e.jsx("option",{value:"",children:l.selectSection}),p.map(t=>e.jsx("option",{value:t.id,children:m?t.name_ar:t.name_en},t.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-4 border-t border-gray-700",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-sm text-gray-400 hover:text-white transition-colors",children:l.cancel}),e.jsx("button",{onClick:g,disabled:!n.job_id||!n.company_id,className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:l.save})]})]})}):null};function ie(){const{language:r}=q(),a=ee[r],{showDialog:d}=B(),{showActionLoading:c,hideActionLoading:l}=G(),{manageJobDistribution:f}=K(),[n,b]=i.useState([]),[m,p]=i.useState(!0),[g,t]=i.useState(""),[S,J]=i.useState(""),[$,C]=i.useState(!1),[y,M]=i.useState({jobs:[],companies:[],sectors:[],departments:[],sections:[]});i.useEffect(()=>{(async()=>{try{const[h,N,x,O,V]=await Promise.all([_(j(v,"jobs")),_(j(v,"companies")),_(j(v,"sectors")),_(j(v,"departments")),_(j(v,"sections"))]);M({jobs:h.docs.map(o=>({id:o.id,...o.data()})),companies:N.docs.map(o=>({id:o.id,...o.data()})),sectors:x.docs.map(o=>({id:o.id,...o.data()})),departments:O.docs.map(o=>({id:o.id,...o.data()})),sections:V.docs.map(o=>({id:o.id,...o.data()}))})}catch(h){console.error(h)}})();const u=H(j(v,"job_distribution"),T("updated_at","desc")),w=I(u,h=>{const N=h.docs.map(x=>({id:x.id,...x.data()}));b(N),p(!1)});return()=>w()},[]);const E=async s=>{C(!1),c(a.saving);const u=await f("add",s);l(),u&&d({variant:"success",title:a.addSuccess,message:""})},P=s=>{d({variant:"confirm",title:a.actions,message:a.confirmDelete,onConfirm:async()=>{c(a.deleting);const u=await f("delete",void 0,s);l(),u&&d({variant:"success",title:a.deleteSuccess,message:""})}})},F=n.filter(s=>{const u=y.jobs.find(x=>String(x.id)===String(s.job_id))?.[r==="ar"?"name_ar":"name_en"]||"",w=y.companies.find(x=>String(x.id)===String(s.company_id))?.[r==="ar"?"name_ar":"name_en"]||"",h=u.toLowerCase().includes(g.toLowerCase())||w.toLowerCase().includes(g.toLowerCase()),N=S?String(s.company_id)===String(S):!0;return h&&N});return e.jsxs("div",{className:"min-h-screen p-6 max-w-7xl mx-auto pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-8 h-8 text-[#FFD700]"}),a.title]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:a.subtitle})]}),e.jsxs("button",{onClick:()=>C(!0),className:"bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-blue-600/20 flex items-center gap-2 transition-all",children:[e.jsx(L,{className:"w-5 h-5"})," ",a.addRule]})]}),e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4 mb-6 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:a.searchPlaceholder,value:g,onChange:s=>t(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg py-2.5 px-4 pl-10 focus:border-[#FFD700] transition-colors text-white"}),e.jsx(R,{className:"w-5 h-5 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsxs("select",{value:S,onChange:s=>J(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg py-2.5 px-4 pl-10 focus:border-[#FFD700] transition-colors text-white appearance-none",children:[e.jsx("option",{value:"",children:a.allCompanies}),y.companies.map(s=>e.jsx("option",{value:s.id,children:r==="ar"?s.name_ar:s.name_en},s.id))]}),e.jsx(Y,{className:"w-5 h-5 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"})]})]}),m?e.jsx("div",{className:"text-center py-20 text-gray-500 animate-pulse",children:"Checking records..."}):F.length===0?e.jsxs("div",{className:"text-center py-20 border-2 border-dashed border-gray-700 rounded-xl bg-gray-800/30",children:[e.jsx(D,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:a.noRules})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(U,{children:F.map(s=>{const u=y.jobs.find(w=>String(w.id)===String(s.job_id))?.[r==="ar"?"name_ar":"name_en"]||s.job_id;return e.jsxs(k.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"bg-gray-800 border border-gray-700 rounded-xl p-4 flex flex-col md:flex-row md:items-center justify-between gap-4 hover:border-gray-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${s.auto_generated?"bg-blue-500/10 text-blue-400 border border-blue-500/20":"bg-[#FFD700]/10 text-[#FFD700] border border-[#FFD700]/20"}`,children:s.auto_generated?e.jsx(W,{className:"w-6 h-6"}):e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-white mb-1",children:u}),e.jsx(se,{rule:s,lookups:y,language:r}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded border ${s.auto_generated?"bg-blue-900/30 text-blue-300 border-blue-800":"bg-green-900/30 text-green-300 border-green-800"}`,children:s.auto_generated?a.autoGenerated:a.manual})})]})]}),e.jsx("button",{onClick:()=>P(s.id),className:"self-end md:self-center p-2 rounded-lg text-gray-500 hover:bg-red-500/10 hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(X,{className:"w-5 h-5"})})]},s.id)})})}),e.jsx(ae,{isOpen:$,onClose:()=>C(!1),onSave:E,lookups:y,t:a,language:r})]})}export{ie as default};
